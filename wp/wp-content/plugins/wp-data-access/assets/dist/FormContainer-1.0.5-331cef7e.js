import{r as m,_ as v,bW as Se,l as s,bX as Ce,b3 as ye,ay as j,bY as oe,bZ as Ee,b_ as Me,b$ as ae,c0 as Fe,j as t,P as ke,b7 as we,c1 as Re,C as _,e as f,c2 as Te,c3 as w,c4 as re,c5 as Ae,c6 as Pe,b6 as Le}from"./main-1.0.5.js";import{b as S,u as Oe,U as Ve,v as Ye,a0 as Be,f as le,B as R,a1 as De,S as T,h as Ne,G as Ue,a2 as se,a3 as ze,m as He}from"./main-1.0.5-a7d73e33.js";import{C as Ge,a as $e,B as p,b as We}from"./AdminTheme-1.0.5-04bcac94.js";import{s as qe,u as Je,i as Qe}from"./ActionsDml-1.0.5-5478d97e.js";import{d as y}from"./dayjs.min-1.0.5-ef136ab2.js";import{C as Xe}from"./CardActions-1.0.5-fc75eb4f.js";m.lazy(()=>v(()=>import("./TableContainer-1.0.5-6eccc43a.js").then(o=>o.T),["./TableContainer-1.0.5-6eccc43a.js","./main-1.0.5.js","./AdminTheme-1.0.5-04bcac94.js","./iconBase-1.0.5-f30be7a9.js","./index.esm-1.0.5-4bc9dd12.js","./Close-1.0.5-697e5a3b.js","./TextField-1.0.5-7ecf712b.js","./main-1.0.5-a7d73e33.js","./main-1.0.5-ca6efa15.css","./FormControlLabel-1.0.5-d0651878.js","./MenuItem-1.0.5-151020c5.js","./settings-1.0.5-a609f2d7.js","./DialogContent-1.0.5-383cf0b4.js","./Tabs-1.0.5-8b2f6dd8.js","./settings-1.0.5-5a196fc8.css","./Radio-1.0.5-9d423ffa.js","./Checkbox-1.0.5-abd3391a.js","./AlertTitle-1.0.5-2a211bdd.js","./useSlot-1.0.5-9b11ffd5.js","./InputAdornment-1.0.5-b81a1094.js","./DateTimePicker-1.0.5-f2511f2b.js","./useMobilePicker-1.0.5-94af1d31.js","./date-time-utils-1.0.5-d782c334.js","./dateViewRenderers-1.0.5-ca3d57b4.js","./TimePicker-1.0.5-a761c18a.js","./DatePicker-1.0.5-3533cde7.js","./ScopeEnum-1.0.5-02ab575a.js","./ActionsDml-1.0.5-5478d97e.js","./useStoreTable-1.0.5-ca420c38.js","./index.esm-1.0.5-cbf5a94b.js","./index-1.0.5-565e836d.js","./vi-1.0.5-b29d2783.js","./dayjs.min-1.0.5-ef136ab2.js","./TableContainer-1.0.5-04aa7508.css"],import.meta.url));m.lazy(()=>v(()=>Promise.resolve().then(()=>ce),void 0,import.meta.url));m.lazy(()=>v(()=>Promise.resolve().then(()=>ce),void 0,import.meta.url));const Ze=o=>{const u=S(d=>Se(d,o));return s.debug("storeColumns",u),u},Ie=o=>{const u=S(d=>Ce(d,o));return s.debug("moreState",u),u};const Ke=m.lazy(()=>v(()=>import("./Row-1.0.5-2e1c7d8f.js"),["./Row-1.0.5-2e1c7d8f.js","./main-1.0.5.js","./main-1.0.5-a7d73e33.js","./iconBase-1.0.5-f30be7a9.js","./main-1.0.5-ca6efa15.css","./AdminTheme-1.0.5-04bcac94.js","./ActionsDml-1.0.5-5478d97e.js","./dayjs.min-1.0.5-ef136ab2.js","./CardActions-1.0.5-fc75eb4f.js"],import.meta.url)),et=m.lazy(()=>v(()=>import("./Alert-1.0.5-445ce146.js"),["./Alert-1.0.5-445ce146.js","./main-1.0.5.js","./index.esm-1.0.5-d46b99b8.js","./iconBase-1.0.5-f30be7a9.js","./AlertTitle-1.0.5-2a211bdd.js","./Close-1.0.5-697e5a3b.js","./useSlot-1.0.5-9b11ffd5.js"],import.meta.url)),tt=({appId:o,primaryKey:u,formMode:d,showTable:x,showForm:E,detailKey:C})=>{var H,G,$,W,q,J,Q,X,Z,I,K,ee;s.debug(o,u,d,C);const g=Oe(),M=Ze(o),ue=Ve(),A=m.useMemo(()=>Ye(),[]),[me,F]=m.useState(!1),[P,L]=m.useState(!1),[O,de]=m.useState(""),e=m.useMemo(()=>ye(j.getState(),o),[o]);s.debug("metaData",e);const b=((G=(H=e==null?void 0:e.app)==null?void 0:H.container[0])==null?void 0:G.cnt_relation)!==void 0&&((W=($=e==null?void 0:e.app)==null?void 0:$.container[0])==null?void 0:W.cnt_relation)!==null&&((J=(q=e==null?void 0:e.app)==null?void 0:q.container[0])==null?void 0:J.cnt_relation)!==""?JSON.parse((X=(Q=e==null?void 0:e.app)==null?void 0:Q.container[0])==null?void 0:X.cnt_relation):{};s.debug("relation",b);const k=S(a=>oe(a,o));s.debug("data",k);const V=S(a=>Ee(a,o));s.debug("initialData",V),m.useEffect(()=>{u===null?fe():Object.keys(u).length>0?ge():F(!0)},[u]);const ge=()=>{qe(o,u,e==null?void 0:e.media,a=>{if(s.debug(a),a!==null){const i={...a.context};delete i.debug;const n={...a.data[0]};g(ae({appId:o,data:n,context:i})),F(a!==null)}else f(_.contactSupport,{variant:"error"})},a=>{s.error("error",a),de(a??_.contactSupport)})},fe=()=>{var a,i;if(e.columns&&Array.isArray(e.columns)){const n={},r=Me(j.getState(),o);s.debug("defaultValues",r);for(let l=0;l<e.columns.length;l++)n[e.columns[l].column_name]=null,r[e.columns[l].column_name]!==void 0&&(r[e.columns[l].column_name]==="@wpda_wp_user_id"?n[e.columns[l].column_name]=(i=(a=e==null?void 0:e.settings)==null?void 0:a.env)==null?void 0:i.id:r[e.columns[l].column_name]==="@now"?e.columns[l]==="date"?n[e.columns[l].column_name]=y(Date.now()).format("YYYY-MM-DD"):n[e.columns[l].column_name]=y(Date.now()).format("YYYY-MM-DD HH:mm:ss"):e.columns[l].column_default!==null&&e.columns[l].column_default!==""?e.columns[l].column_default==="CURRENT_TIMESTAMP"?e.columns[l]==="date"?n[e.columns[l].column_name]=y(Date.now()).format("YYYY-MM-DD"):n[e.columns[l].column_name]=y(Date.now()).format("YYYY-MM-DD HH:mm:ss"):n[e.columns[l].column_name]=e.columns[l].column_default:n[e.columns[l].column_name]=r[e.columns[l].column_name]);s.debug(n),g(ae({appId:o,data:n,context:{media:{}}})),s.debug("init"),F(!0)}},Y=()=>{let a="";for(const i in e.columns)e.columns[i].extra==="auto_increment"&&(a=e.columns[i].column_name);return s.debug(a),a},_e=a=>{for(let i=0;i<e.columns.length;i++)if(e.columns[i].column_name===a)return e.columns[i]},xe=a=>{const i=Te(j.getState(),o);s.debug("rowValidation",i);let n=!1;for(const c in i)if(i[c].error===!0&&i[c].type===w.COLUMN){n=!0;break}if(n)return s.debug("validateForm returned errors"),!1;let r=!0;const l=Y();for(const c in a){const te=_e(c);let ne=!0;te.column_name!==l&&te.is_nullable==="NO"&&(a[c]===""&&(d===se.INSERT||h.preserveSpacesOnUpdate===!1)||a[c]===null||a[c]===void 0)&&(g(re({appId:o,columnName:c,columnError:!0,columnText:"Field must be entered",columnType:w.FORM})),ne=!1,r=!1);const je=Ae(j.getState(),o,c);s.debug(je),ne&&g(re({appId:o,columnName:c,columnError:!1,columnText:"",columnType:w.FORM}))}return r},B=a=>{const i=oe(j.getState(),o);if(s.debug(i),xe(i))if(u!==null){const n={};Object.keys(i).map(r=>{M.map(l=>{r===l.columnName&&l.updatable&&(n[r]=i[r])})}),s.debug(n),Je(o,u,n,r=>{var l;if(s.debug(r),r!=null&&r.code&&(r!=null&&r.message))switch(r.code){case"ok":L(!0),f(r.message,{variant:"success"}),((l=r.context)==null?void 0:l.updated)!==void 0&&Object.keys(r.context.updated).map(c=>{g(Pe({appId:o,columnName:c,columnValue:r.context.updated[c]}))}),a&&setTimeout(()=>{x(!0)},1e3);break;case"info":f(r.message,{variant:"info"}),a&&setTimeout(()=>{x(!0)},1e3);break;default:s.error(r),f(r.message??_.contactSupport,{variant:"error"}),a&&x(P)}else s.error(r),f(_.contactSupport,{variant:"error"})},r=>{s.error("error",r),f(r??_.contactSupport,{variant:"error"})})}else Qe(o,i,n=>{if(s.debug(n),n!=null&&n.code&&(n!=null&&n.message)){let r;const l={};switch(n.code){case"ok":if(L(!0),f(n.message,{variant:"success"}),a){x(!0);return}r=Y();for(let c=0;c<e.primary_key.length;c++)r!==""?l[e.primary_key[c]]=n.context.insert_id:l[e.primary_key[c]]=i[e.primary_key[c]];s.debug(l),E(l,ze.UPDATE);break;default:s.error(n),f(n.message??_.contactSupport,{variant:"error"})}}else s.error(n),f(_.contactSupport,{variant:"error"})},n=>{s.error("error",n),f(n??_.contactSupport,{variant:"error"})})},be=()=>{B(!1)},pe=()=>{B(!0)},D=()=>{x(P)},h=Be(o),N=S(a=>Fe(a,o));s.debug("moreEnabled",N);const U=Ie(o);le("(max-width: 600px)"),le("(max-width: 900px)");const ve={paddingTop:"50px",paddingBottom:"50px",paddingLeft:"50px",paddingRight:"50px"};let z="30px",he="0";return O!==""?t.jsx(m.Suspense,{children:t.jsx(et,{severity:"error",message:O,close:!1})}):t.jsx("div",{className:`${o}_wrapper pp-form`,children:me&&k!==null?t.jsxs(Ge,{sx:ve,elevation:ue,children:[t.jsx($e,{sx:{padding:0,margin:"5px 0 0 0"},children:t.jsx("form",{id:A,className:"pp-form-content",onSubmit:a=>(a.preventDefault(),!1),children:t.jsx(R,{className:"pp-form-grid",sx:{display:"grid",gridTemplateColumns:{lg:`repeat(${h.cellsPerRow}, 1fr)`,md:"repeat("+Math.min(h.cellsPerRow,2)+", 1fr)",xs:"1fr"},gap:z,marginBottom:0,background:h.showGrid?((Z=De)==null?void 0:Z.palette.mode)===ke.LIGHT?"repeating-linear-gradient( -45deg, transparent, transparent 10px, #eee 10px, #eee 20px )":"repeating-linear-gradient( -45deg, transparent, transparent 10px, #111 10px, #111 20px )":""},children:t.jsx(m.Suspense,{fallback:t.jsx(T,{}),children:t.jsx(Ke,{appId:o,metaData:e,data:k,initialData:V,primaryKey:u,formMode:d,formSettings:h})})})})}),t.jsxs(Xe,{sx:{marginTop:z,padding:0,paddingRight:he,justifyContent:"space-between",alignItems:"center"},children:[t.jsxs(R,{sx:{display:"flex",gap:"8px"},children:[((I=e==null?void 0:e.app)==null?void 0:I.container[0].cnt_relation)!==void 0&&((K=e==null?void 0:e.app)==null?void 0:K.container[0].cnt_relation)!==null&&((ee=e==null?void 0:e.app)==null?void 0:ee.container[0].cnt_relation)!==""&&t.jsx(p,{variant:"contained",className:"pp-builder-button",startIcon:t.jsx(Ne,{}),onClick:()=>{g(we({appId:o}))},children:"Form Builder"}),N&&t.jsx(p,{variant:"outlined",startIcon:t.jsx(Ue,{}),onClick:()=>{g(Re({appId:o,more:!U}))},children:U?"Less":"More"})]}),t.jsx(R,{children:d!==se.VIEW?t.jsxs(t.Fragment,{children:[t.jsx(p,{variant:"contained",onClick:be,type:"submit",form:A,children:"APPLY"}),(b==null?void 0:b.cardinality)!==0&&t.jsxs(t.Fragment,{children:[t.jsx(p,{variant:"outlined",onClick:pe,sx:{marginLeft:"8px"},children:"OK"}),t.jsx(p,{variant:"outlined",onClick:D,sx:{marginLeft:"8px"},children:"CANCEL"})]})]}):t.jsx(t.Fragment,{children:(b==null?void 0:b.cardinality)!==0&&t.jsx(p,{variant:"contained",onClick:D,children:"BACK"})})})]}),t.jsx(t.Fragment,{children:!1})]}):t.jsx("div",{style:{padding:"50px"},children:t.jsx(T,{title:"Loading data..."})})})},nt=m.lazy(()=>v(()=>import("./Settings-1.0.5-8e24d433.js"),["./Settings-1.0.5-8e24d433.js","./main-1.0.5.js","./main-1.0.5-a7d73e33.js","./iconBase-1.0.5-f30be7a9.js","./main-1.0.5-ca6efa15.css","./AdminTheme-1.0.5-04bcac94.js","./useMetadataColumns-1.0.5-808235db.js","./useStoreTable-1.0.5-ca420c38.js","./index.esm-1.0.5-d97070f8.js","./ActionsDml-1.0.5-5478d97e.js","./index.esm-1.0.5-cbf5a94b.js","./TextField-1.0.5-7ecf712b.js","./Close-1.0.5-697e5a3b.js","./MenuItem-1.0.5-151020c5.js","./index-1.0.5-198423ad.js","./useTableUpdater-1.0.5-66078c4a.js","./Stepper-1.0.5-49dc98b0.js","./settings-1.0.5-a609f2d7.js","./FormControlLabel-1.0.5-d0651878.js","./DialogContent-1.0.5-383cf0b4.js","./Tabs-1.0.5-8b2f6dd8.js","./settings-1.0.5-5a196fc8.css","./Checkbox-1.0.5-abd3391a.js","./AccordionSummary-1.0.5-0d0601e8.js","./useSlot-1.0.5-9b11ffd5.js","./PremiumFeature-1.0.5-90d69706.js","./EnumTypeEnum-1.0.5-7ffcf33a.js","./ScopeEnum-1.0.5-02ab575a.js","./RadioGroup-1.0.5-2e2c1c10.js","./Radio-1.0.5-9d423ffa.js","./Link-1.0.5-1e4979fb.js","./CssUnitTextField-1.0.5-f5c56eef.js","./ComponentDatabase-1.0.5-ceecb292.js","./ActionsApp-1.0.5-194aa982.js","./ActionsExplorer-1.0.5-40895003.js","./DefaultWhere-1.0.5-8f1d5f14.js","./ThemeSettings-1.0.5-b3111983.js","./index-1.0.5-565e836d.js"],import.meta.url)),ie=({appId:o,primaryKey:u,formMode:d,showTable:x,showForm:E,metaData:C,detailKey:g})=>{s.debug(o,u,d,C,g);const M=We();return t.jsxs(t.Fragment,{children:[t.jsx(tt,{appId:o,primaryKey:u,formMode:d,showTable:x,showForm:E,detailKey:g}),Le(C)&&t.jsx(He,{theme:M,children:t.jsx(m.Suspense,{fallback:t.jsx(T,{title:"Loading form settings..."}),children:t.jsx(nt,{appId:o})})})]})},ce=Object.freeze(Object.defineProperty({__proto__:null,FormContainer:ie,default:ie},Symbol.toStringTag,{value:"Module"}));export{ce as F,Ie as a,Ze as u};
