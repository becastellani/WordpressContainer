import{l as r,r as f,A as W,j as t,cP as F,e as h,C as g,cQ as L,cR as S,cS as N,cT as R,cU as P,cV as w,cW as A,cX as B,cY as V,cZ as O,c_ as q,c$ as z,d0 as H,d1 as I,d2 as C}from"./main-1.0.5.js";import{u as v,B as D,a as Q,T as X,ae as Y,b as x}from"./main-1.0.5-a7d73e33.js";import{A as Z}from"./AdminTheme-1.0.5-04bcac94.js";import{j as $}from"./ActionsApp-1.0.5-194aa982.js";import{F as T,b as G,a as y,A as k,T as M}from"./TextField-1.0.5-7ecf712b.js";import{P as J,I as K}from"./iconBase-1.0.5-f30be7a9.js";import{F as U}from"./FormControlLabel-1.0.5-d0651878.js";import{C as aa}from"./Checkbox-1.0.5-abd3391a.js";import{d as _,e as E,h as ea}from"./ActionsExplorer-1.0.5-40895003.js";const da=({app:e,setIsUpdated:o})=>{r.debug(e);const i=v(),[m,p]=f.useState(!1),c=f.useRef(!0);f.useEffect(()=>{c.current?c.current=!1:s()},[e.appDatabase,e.appTable,i]);const s=()=>{e.appDatabase!==null&&e.appTable!==null&&(p(!0),$(e.appDatabase,e.appTable,!1,function(l){const d=l==null?void 0:l.data;if(r.debug("response data",e.appDatabase,e.appTable,d),!d.columns)h(g.contactSupport,{variant:"error"});else{const u=[];d.columns.map(b=>{b.column_name!==void 0&&u.push({columnName:b.column_name,isSelected:!0})}),i(L({appColumns:u,appMetaData:d}))}p(!1)},l=>{r.error("error",l),h(l??g.contactSupport,{variant:"error"}),p(!1)}))},[a,n]=f.useState(!1);return r.debug("hasErrors",a),f.useEffect(()=>{Number(e.appType)!==W.DATATABLE&&e.appMetaData.primary_key!==void 0?n(e.appMetaData.primary_key.length===0||e.appMetaData.primary_key.filter(l=>e.appColumns.filter(u=>u.isSelected).map(u=>u.isSelected?u.columnName:!1).includes(l)).length!==e.appMetaData.primary_key.length):n(!1)},[e]),t.jsxs(D,{sx:{position:"relative"},children:[t.jsxs(T,{fullWidth:!0,children:[t.jsxs(D,{component:"fieldset",sx:{borderWidth:1,borderRadius:"4px","& .MuiPaper-root":{border:"none",padding:"15px 20px"},"& .MuiFormHelperText-root":{marginLeft:"20px",marginBottom:"20px"}},children:[t.jsx("legend",{style:{fontSize:"0.75rem",fontWeight:400,color:"rgba(0, 0, 0, 0.6)"},children:"Select columns *"}),t.jsxs(J,{variant:"outlined",sx:{padding:"15px 30px"},children:[e.appColumns.length===0&&t.jsx(T,{fullWidth:!0,sx:{margin:"5px 0"},children:t.jsx(G,{sx:{color:"inherit"},children:"No table selected"})}),...e.appColumns.map((l,d)=>{var u;return t.jsx(U,{control:t.jsx(aa,{checked:l.isSelected,onChange:(b,j)=>{i(F({appColumns:[...e.appColumns.slice(0,d),{columnName:l.columnName,isSelected:j},...e.appColumns.slice(d+1)]})),o&&o(!0)}}),label:t.jsx(D,{sx:{color:a&&e.appMetaData.primary_key.includes(l.columnName)?(u=Z)==null?void 0:u.palette.error.main:""},children:l.columnName+(a&&e.appMetaData.primary_key.includes(l.columnName)?" (primary key column)":"")}),sx:{width:"100%"}})})]})]}),t.jsx(y,{children:"Only selected columns are available in tables and forms. Unselected columns are excluded from responses. At least one column must be selected."}),!m&&e.appDatabase!==null&&e.appTable!==null&&a&&t.jsxs(y,{error:!0,sx:{marginTop:"20px",width:"fit-content",display:"inline-grid",gridTemplateColumns:"40px auto",justifyContent:"space-around",alignItems:"center"},children:[t.jsx(Q,{size:"24px"}),t.jsx("span",{children:e.appMetaData.primary_key.length===0?t.jsx(t.Fragment,{children:"This table contains no primary key. Transactions are not supported for tables without a primary key. Please create a primary key to continue or select app type Data Table in the app info tab."}):t.jsxs(t.Fragment,{children:["Transactions require all primary key columns to be selected. With the current settings transactions will be disabled for table ",e.appTable,"."]})})]})]}),t.jsx(D,{sx:{position:"absolute",top:"15px",right:"10px"},children:t.jsx(X,{title:"Refresh column list",children:t.jsx(K,{onClick:()=>{s()},children:t.jsx(Y,{})})})})]})},pa=({setIsUpdated:e})=>{const o=v(),i=x(s=>S(s));r.debug("appDatabase",i);const m=x(s=>N(s));r.debug("tables",m);const p=x(s=>R(s));r.debug("views",p);const c=x(s=>P(s));return r.debug("appTable",c),f.useEffect(()=>{i!==null&&(m.length===0||p.length===0)&&(_(i,function(s){const a=s==null?void 0:s.data;r.debug("response data",a),o(w({tables:a}))},s=>{r.error("error",s),h(s??g.contactSupport,{variant:"error"})}),E(i,function(s){const a=s==null?void 0:s.data;r.debug("response data",a),o(A({views:a}))},s=>{r.error("error",s),h(s??g.contactSupport,{variant:"error"})}))},[i]),t.jsxs(T,{sx:{width:"100%",marginTop:"8px"},children:[t.jsx(k,{options:i!==null?m.concat(p).sort():[],value:c,onChange:(s,a)=>{o(B({appTable:a??null})),e&&e(!0)},renderInput:s=>t.jsx(M,{...s,label:"Table *",variant:"outlined"}),sx:{width:"100%"}}),t.jsx(y,{children:"Select a table from the list (additional tables can be added in the Table Builder)"})]})},ba=({setIsUpdated:e})=>{const o=v(),i=x(a=>V(a));r.debug("databases",i);const m=x(a=>O(a));r.debug("wpDatabase",m);const p=x(a=>q(a));r.debug("defaultDatabase",p);const c=x(a=>S(a));r.debug("appDatabase",c),f.useEffect(()=>{i.length===0?ea(function(a){const n=a==null?void 0:a.data;r.debug("response data",n);const l=[];let d="",u="";n.map(b=>{l.push(b.dbs),b.dbs_type.toLocaleLowerCase()==="wp"&&(d=b.dbs,u=b.dbs)}),l.sort((b,j)=>b.localeCompare(j,void 0,{sensitivity:"base"})),o(z({databases:l})),o(H({wpDatabase:d})),o(I({defaultDatabase:u})),c===null&&o(C({appDatabase:u})),r.debug(l,d,u)},a=>{r.error("error",a),h(a??g.contactSupport,{variant:"error"})}):c===null&&o(C({appDatabase:p}))},[]);const s=f.useRef(!0);return f.useEffect(()=>{s.current?s.current=!1:c!==null&&i.includes(c)&&(_(c,function(a){const n=a==null?void 0:a.data;r.debug("response data",n),o(w({tables:n}))},a=>{r.error("error",a),h(a??g.contactSupport,{variant:"error"})}),E(c,function(a){const n=a==null?void 0:a.data;r.debug("response data",n),o(A({views:n}))},a=>{r.error("error",a),h(a??g.contactSupport,{variant:"error"})}))},[c]),t.jsxs(T,{sx:{width:"100%",marginTop:"8px"},children:[t.jsx(k,{options:i,value:c,onChange:(a,n)=>{o(C({appDatabase:n??null})),e&&e(!0)},getOptionLabel:a=>m===a?a+" (WordPress database)":a,renderInput:a=>t.jsx(M,{...a,label:"Database *",variant:"outlined"}),renderOption:(a,n)=>t.jsxs(D,{component:"li",sx:{"& > img":{mr:2,flexShrink:0}},...a,children:[n," ",m===n?" (WordPress database)":""]}),sx:{width:"100%"}}),t.jsx(y,{children:"Select a database from the list"})]})};export{ba as C,pa as a,da as b};
