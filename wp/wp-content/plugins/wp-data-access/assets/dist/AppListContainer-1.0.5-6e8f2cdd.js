import{l as r,j as e,s as we,a as Le,g as be,b as Oe,A as T,r as f,e as m,C as y,c as pe,d as ze,R as F,f as H,h as _e,i as Be,P as Fe,k as de,u as fe,m as Pe,n as le,o as ue,p as Ge,q as qe,t as We,v as He,w as Ye,x as Je,y as Ze,z as xe,B as he,D as $e,E as Ke,F as Ve,G as Qe,H as Xe,I as Ue,J as et,K as tt,L as U,M as st}from"./main-1.0.5.js";import{B as P,A as Y,C as ie,a as ae,b as rt}from"./AdminTheme-1.0.5-04bcac94.js";import{B as l,u as O,M as J,a as it,b as k,T as L,c as at,A as je,d as Ae,e as Te,f as K,g as nt,h as ot,i as pt,S as lt,D as w,j as ct,k as dt,l as ut,v as xt,m as ht,n as mt,o as gt}from"./main-1.0.5-a7d73e33.js";import{T as ee,C as V,s as bt,S as ye,R as ft,a as te,B as jt,b as At,c as Tt,d as yt,e as se}from"./settings-1.0.5-a609f2d7.js";import{C as Ce,a as ve,b as Se}from"./ComponentDatabase-1.0.5-ceecb292.js";import{A as N,a as I,b as Z}from"./AccordionSummary-1.0.5-0d0601e8.js";import{T as q,F as Q,I as Ct,S as vt,a as X,b as ne,A as oe}from"./TextField-1.0.5-7ecf712b.js";import{M as St}from"./MenuItem-1.0.5-151020c5.js";import{a as Dt,b as Rt,c as Mt,d as kt,e as Nt,f as It}from"./ActionsApp-1.0.5-194aa982.js";import{R as Et}from"./RadioGroup-1.0.5-2e2c1c10.js";import{R as me}from"./Radio-1.0.5-9d423ffa.js";import{F as De}from"./FormControlLabel-1.0.5-d0651878.js";import{l as wt,C as Lt}from"./index-1.0.5-aeb53849.js";import{I as G,T as ge,P as Re}from"./iconBase-1.0.5-f30be7a9.js";import{T as re}from"./Tabs-1.0.5-8b2f6dd8.js";import{B as W}from"./index.esm-1.0.5-d46b99b8.js";import{L as $}from"./Link-1.0.5-1e4979fb.js";import{c as Ot}from"./index-1.0.5-198423ad.js";import{S as zt,a as _t,b as Bt}from"./Stepper-1.0.5-49dc98b0.js";import{A as Ft}from"./AppMetaData-1.0.5-da5003c5.js";import{I as Pt}from"./InputAdornment-1.0.5-b81a1094.js";import{C as Gt}from"./Checkbox-1.0.5-abd3391a.js";import"./Close-1.0.5-697e5a3b.js";import"./DialogContent-1.0.5-383cf0b4.js";import"./ActionsExplorer-1.0.5-40895003.js";import"./useSlot-1.0.5-9b11ffd5.js";import"./Alert-1.0.5-445ce146.js";import"./AlertTitle-1.0.5-2a211bdd.js";const qt=({app:t,setIsUpdated:n})=>(r.debug(t),e.jsxs(l,{children:[e.jsx(N,{disableGutters:!0,children:e.jsx(I,{children:e.jsx(Ce,{setIsUpdated:n})})}),e.jsx(N,{disableGutters:!0,children:e.jsx(I,{children:e.jsx(ve,{setIsUpdated:n})})}),e.jsx(N,{disableGutters:!0,children:e.jsx(I,{children:e.jsx(Se,{app:t,setIsUpdated:n})})})]})),Me=({app:t,hasErrors:n,setIsUpdated:o})=>{r.debug(t,n);const s=O();return e.jsx(q,{type:"text",label:"App Name",error:n,fullWidth:!0,required:!0,helperText:"App name must be unique",value:t.appName,autoFocus:!0,autoComplete:"off",onChange:u=>{s(we({appName:u.target.value})),o&&o(!0)}})},ke=({app:t,hasErrors:n,setIsUpdated:o})=>{r.debug(t,n);const s=O();return e.jsx(q,{type:"text",label:"App Title",error:n,fullWidth:!0,required:!0,helperText:"App title describes the purpose of the app",value:t.appTitle,autoComplete:"off",onChange:u=>{s(Le({appTitle:u.target.value})),o&&o(!0)}})},Ne=({app:t,setIsUpdated:n})=>{r.debug(t);const o=O(),s=be();return r.debug(s),e.jsxs(Q,{children:[e.jsx(Ct,{variant:"outlined",children:"App Type *"}),e.jsxs(vt,{label:"App Type *",value:t.appType,onChange:u=>{o(Oe({appType:u.target.value})),n&&n(!0)},children:[...s.map(u=>{const j=u.id===T.DATATABLE||u.id===T.DATAENTRY;return e.jsx(St,{value:u.id,disabled:!j,children:u.text})})]}),e.jsx(X,{children:"Select app type from drop-down list (currently supporting Data Tables and Data Administration only, more types will be added later)"})]})},Wt=({app:t})=>{r.debug(t);const[n,o]=f.useState(!1),[s,u]=f.useState(void 0),j=()=>{switch(s){case"form":return"Reset Form Builder?";case"theme":return"Reset Theme?";default:return"Reset Table Builder?"}};return e.jsxs(e.Fragment,{children:[e.jsxs(N,{disableGutters:!0,children:[e.jsx(I,{expandIcon:e.jsx(J,{}),children:"Reset"}),e.jsx(Z,{children:e.jsxs(Q,{sx:{display:"grid",gridGap:"20px"},children:[e.jsx(P,{variant:"contained",color:"primary",onClick:()=>{u(ee.TABLE),o(!0)},children:"Reset Table Builder"}),e.jsx(P,{variant:"contained",color:"primary",onClick:()=>{u(ee.FORM),o(!0)},children:"Reset Form Builder"}),e.jsx(P,{variant:"contained",color:"primary",onClick:()=>{u(ee.THEME),o(!0)},children:"Reset Theme"}),e.jsxs(X,{sx:{display:"inline-grid",gridTemplateColumns:"20px auto",gridGap:"5px",alignItems:"center","& svg":{fontSize:"20px"}},children:[e.jsx(it,{}),"A reset cannot be undone!"]})]})})]}),e.jsx(V,{title:j(),message:"Are you sure? This action cannot be undone!",open:n,setOpen:o,onConfirm:()=>{s!==void 0&&bt(t.appDbId,t.appCntId,s,null,null,x=>{if(x!=null&&x.code&&(x==null?void 0:x.message)!==void 0)switch(x.code){case"ok":m(x.message,{variant:"success"});break;case"info":m(x.message,{variant:"info"});break;default:m(x.message??y.contactSupport,{variant:"error"})}else r.error(x),m(y.contactSupport,{variant:"error"})},x=>{r.error("error",x),m(x??y.contactSupport,{variant:"error"})})}})]})},Ht=({app:t,setIsUpdated:n})=>(r.debug(t),e.jsxs(l,{children:[e.jsx(N,{disableGutters:!0,children:e.jsx(I,{children:e.jsx(Me,{app:t,hasErrors:!1,setIsUpdated:n})})}),e.jsx(N,{disableGutters:!0,children:e.jsx(I,{children:e.jsx(ke,{app:t,hasErrors:!1,setIsUpdated:n})})}),e.jsx(N,{disableGutters:!0,children:e.jsx(I,{children:e.jsx(Ne,{app:t,setIsUpdated:n})})}),e.jsx(Wt,{app:t})]})),Ie=({setIsUpdated:t})=>{const n=O(),o=k(i=>pe(i));r.debug("app",o);const s=k(i=>ze(i));r.debug("appMetaData",s);const u=f.useMemo(()=>{const i=[];if((s==null?void 0:s.roles)!==void 0)for(const A in s.roles)i.push({key:A,value:s.roles[A]});return i},[s.roles]);r.debug(u);const j=f.useMemo(()=>{const i=[];if((s==null?void 0:s.users)!==void 0)for(const A in s.users)i.push({key:A,value:s.users[A]});return i},[s.users]);r.debug(j);const x=f.useMemo(()=>u.filter(i=>o.appRestApi.authorized_roles.includes(i.key)),[o.appRestApi.authorized_roles,u]),a=f.useMemo(()=>j.filter(i=>o.appRestApi.authorized_users.includes(i.key)),[o.appRestApi.authorized_users,j]);return e.jsxs(Q,{sx:{width:"100%"},children:[e.jsxs(Et,{children:[e.jsxs(ne,{className:"align-label-radio",sx:{cursor:"pointer"},children:[e.jsx(me,{checked:o.appRestApi.authorization===F.AUTHORIZED,onChange:i=>{n(H({restApiActions:{...o.appRestApi,authorization:F.AUTHORIZED}})),t&&t(!0),i.stopPropagation()}}),"Authorized access only"]}),e.jsxs(l,{sx:{display:"grid",gridGap:"10px",margin:"30px 20px 25px 42px"},children:[e.jsx(oe,{multiple:!0,options:u,getOptionLabel:i=>i.value,value:x,onChange:(i,A)=>{n(H({restApiActions:{...o.appRestApi,authorized_roles:A.map(D=>D.key)}})),t&&t(!0),i.stopPropagation()},renderInput:i=>e.jsx(q,{...i,label:"Roles"})}),e.jsx(oe,{multiple:!0,options:j,getOptionLabel:i=>i.value,value:a,onChange:(i,A)=>{n(H({restApiActions:{...o.appRestApi,authorized_users:A.map(D=>D.key)}})),t&&t(!0),i.stopPropagation()},renderInput:i=>e.jsx(q,{...i,label:"Users"})})]}),e.jsxs(ne,{className:"align-label-radio",sx:{cursor:"pointer"},children:[e.jsx(me,{checked:o.appRestApi.authorization===F.ANONYMOUS,onChange:i=>{n(H({restApiActions:{...o.appRestApi,authorization:F.ANONYMOUS}})),t&&t(!0),i.stopPropagation()}}),"Anonymous access"]})]}),o.appRestApi.authorization===F.ANONYMOUS&&e.jsx(l,{sx:{marginTop:"10px",marginLeft:"10px"},children:e.jsx(X,{children:"This setting allows non-authorized users to access this app"})})]})},Yt=({app:t,setIsUpdated:n})=>{r.debug(t);const o=O();return e.jsxs(l,{sx:{display:"grid",gridGap:"30px"},children:[e.jsx(De,{control:e.jsx(ye,{checked:t.appAddToMenu,onChange:(s,u)=>{o(_e({appAddToMenu:u})),n&&n(!0),s.stopPropagation()}}),label:"Add App to WordPress dashboard menu",labelPlacement:"end"}),t.appAddToMenu&&e.jsx(q,{type:"text",label:"Title",fullWidth:!0,required:!0,helperText:"Title shown in WordPress dashboard menu",value:t.appMenuTitle,autoComplete:"off",onChange:s=>{o(Be({appMenuTitle:s.target.value})),n&&n(!0),s.stopPropagation()}})]})},Jt=({app:t,setIsUpdated:n})=>{r.debug(t);const o=()=>`[wpda_app app_id="${t.appDbId}"${s?' feedback="true"':""}]`,[s,u]=f.useState(!1),[j,x]=f.useState(o());return f.useEffect(()=>{x(o())},[s]),e.jsxs(l,{sx:{display:"grid",gridGap:"20px"},children:[e.jsxs(l,{children:[e.jsx(ne,{children:"App short code"}),e.jsxs(l,{sx:{display:"grid",gridTemplateColumns:"auto auto",justifyContent:"space-between",alignItems:"center","& pre":{backgroundColor:"#ccc",padding:"4px"}},children:[e.jsx("pre",{children:j}),e.jsx(wt.CopyToClipboard,{text:j,onCopy:()=>{m("Shortcode was copied to your clipboard",{variant:"info"})},children:e.jsx(L,{title:"Copy shortcode to clipboard",children:e.jsx(G,{children:e.jsx(at,{})})})})]})]}),e.jsx(l,{children:e.jsxs(Q,{children:[e.jsx(De,{control:e.jsx(ye,{checked:s,onChange:(a,i)=>{u(i),n&&n(!0),a.stopPropagation()}}),label:"Feedback",labelPlacement:"end"}),e.jsx(X,{children:"Show authorization and usage errors"})]})})]})},Zt=({app:t,setIsUpdated:n})=>(r.debug(t),e.jsxs(l,{children:[e.jsxs(N,{disableGutters:!0,children:[e.jsx(I,{expandIcon:e.jsx(J,{}),children:"Authorize Roles & Users"}),e.jsx(Z,{children:e.jsx(Ie,{setIsUpdated:n})})]}),e.jsxs(N,{disableGutters:!0,children:[e.jsx(I,{expandIcon:e.jsx(J,{}),children:"Back-end Access"}),e.jsx(Z,{children:e.jsx(Yt,{app:t,setIsUpdated:n})})]}),e.jsxs(N,{disableGutters:!0,children:[e.jsx(I,{expandIcon:e.jsx(J,{}),children:"Front-end Access"}),e.jsx(Z,{children:e.jsx(Jt,{app:t,setIsUpdated:n})})]})]})),$t=({appDbId:t})=>{var g,M;r.debug(t);const n=O(),o=((g=Y)==null?void 0:g.palette.mode)===Fe.LIGHT?(M=Y)==null?void 0:M.palette.primary.main:"",[s,u]=f.useState(!1);r.debug(s);const[j,x]=f.useState(!1);r.debug(j);const a=k(d=>pe(d));r.debug("app",a);const i=()=>{n(fe({}))},A=()=>{s?x(!0):i()},D=()=>a.appName?a.appTitle?a.appDatabase?a.appTable?a.appColumns.filter(d=>d.isSelected).length===0?(m("At least one column must be selected",{variant:"error"}),!1):!0:(m("Table is required",{variant:"error"}),!1):(m("Database is required",{variant:"error"}),!1):(m("App title is required",{variant:"error"}),!1):(m("App name is required",{variant:"error"}),!1),R=()=>{D()&&(r.debug(a),Dt(a,d=>{if(r.debug(d),d!=null&&d.code&&(d==null?void 0:d.message)!==void 0)switch(d.code){case"ok":m(d.message,{variant:"success"}),n(le({}));break;case"info":m(d.message,{variant:"info"});break;default:r.error(d),m(d.message??y.contactSupport,{variant:"error"})}else r.error(d),m(y.contactSupport,{variant:"error"})},d=>{r.error("error",d),m(d??y.contactSupport,{variant:"error"})}))},p=()=>{R(),i()},S=d=>{n(Pe({anchor:d}))},[C,z]=f.useState("1"),h=(d,v)=>{z(v)};return e.jsxs(e.Fragment,{children:[e.jsxs(ft,{closeDrawer:A,children:[e.jsx(je,{position:"static",elevation:4,sx:{borderRadius:0},children:e.jsxs(Ae,{className:"pp-setting-toolbar",sx:{borderRadius:0},children:[e.jsxs(l,{sx:{flexGrow:1},children:[e.jsx(ge,{variant:"h5",noWrap:!0,component:"div",className:"unselectable",sx:{display:{xs:"none",sm:"block"},paddingLeft:"6px"},children:"Manage App"}),e.jsx(ge,{sx:{fontSize:"10px",display:{xs:"none",sm:"block"},paddingLeft:"10px"},children:a.appName})]}),e.jsx(te,{title:"Dock to left",position:"bottom",children:e.jsx(G,{onClick:()=>{S(de.LEFT)},size:"large",color:"inherit",sx:{fontSize:"1em"},children:e.jsx(jt,{})})}),e.jsx(te,{title:"Dock to right",position:"bottom",children:e.jsx(G,{onClick:()=>{S(de.RIGHT)},size:"large",color:"inherit",sx:{fontSize:"1em"},children:e.jsx(At,{})})}),e.jsx(te,{title:"Close",position:"bottom",children:e.jsx(G,{onClick:A,size:"large",color:"inherit",sx:{fontSize:"1.4em"},children:e.jsx(Te,{})})})]})}),e.jsx(ie,{className:"pp-settings-container",children:e.jsx(ae,{sx:{padding:0,margin:0},children:e.jsxs(Tt,{value:C,children:[e.jsxs(yt,{variant:"fullWidth",textColor:"primary",onChange:h,sx:{width:"100%",height:"80px",padding:0,margin:0,backgroundColor:"rgb(242, 242, 242)"},children:[e.jsx(re,{label:"App Info",value:"1",sx:{fontWeight:"bold",fontSize:"110%",height:"80px"}}),e.jsx(re,{label:"Data Source",value:"2",sx:{fontWeight:"bold",fontSize:"110%",height:"80px"}}),e.jsx(re,{label:"Access",value:"3",sx:{fontWeight:"bold",fontSize:"110%",height:"80px"}})]}),e.jsxs(l,{sx:{margin:0,padding:0,overflowY:"auto",height:"calc(100vh - 250px)","& > div.MuiTabPanel-root":{padding:0}},children:[e.jsx(se,{value:"1",children:e.jsx(Ht,{app:a,setIsUpdated:u})}),e.jsx(se,{value:"2",children:e.jsx(qt,{app:a,setIsUpdated:u})}),e.jsx(se,{value:"3",children:e.jsx(Zt,{app:a,setIsUpdated:u})})]})]})})}),e.jsx(ie,{className:"pp-setting-footer",sx:{borderRadius:0,backgroundColor:o},children:e.jsxs(ae,{className:"pp-setting-footer-buttons",sx:{borderRadius:0},children:[e.jsx(P,{variant:"outlined",className:"footer_action_button_apply",onClick:R,children:"Apply"}),e.jsx(P,{variant:"outlined",className:"footer_action_button",onClick:p,children:"OK"}),e.jsx(P,{variant:"outlined",className:"footer_action_button",onClick:A,children:"Cancel"})]})})]}),e.jsx(V,{title:"Close App Manager?",message:"All uncommitted changes will be lost!",open:j,setOpen:x,onConfirm:()=>{i()},onKeep:()=>{i()}})]})},Kt=({app:t})=>{var A,D,R;r.debug(t);const n=O(),[o,s]=f.useState(!1),u=p=>{Rt(p,S=>{var z;const C=S==null?void 0:S.data;if(r.debug("response data",C),C.app&&C.app.app&&Array.isArray(C.app.app)&&C.app.container&&Array.isArray(C.app.container)){const h=C.app.app[0],g=C.app.container[0];r.debug(h,g);let M=[];try{M=JSON.parse(g.cnt_cls)}catch(v){r.error("Invalid JSON - app columns"),r.error(v),m("Invalid JSON, check console",{variant:"error"})}let d={};try{d=JSON.parse(h.app_settings)}catch(v){d.rest_api={authorization:F.AUTHORIZED,authorized_roles:[],authorized_users:[]},r.error("Invalid JSON - app settings"),r.error(v),m("Invalid JSON, check console",{variant:"error"})}n(qe({appDbId:p,appId:We(p),appName:h.app_name,appTitle:h.app_title,appType:h.app_type,appCntId:g.cnt_id,appCntSeqNr:g.cnt_seq_nr,appDatabase:g.cnt_dbs,appTable:g.cnt_tbl,appColumns:M,appRestApi:d==null?void 0:d.rest_api,appAddToMenu:h.app_add_to_menu!=="0",appMenuTitle:((z=d==null?void 0:d.settings)==null?void 0:z.app_menu_title)??h.app_title,appMetaData:C}))}else m(y.contactSupport,{variant:"error"})},S=>{r.error("error",S),m(S??y.contactSupport,{variant:"error"})})},j=()=>{switch(t.appType){case T.DATAENTRY:return e.jsx(W,{});case T.MASTERDETAIL:return e.jsx(W,{});case T.REGISTRATION:return e.jsx(W,{});case T.UPDATEFORM:return e.jsx(W,{});default:return e.jsx(W,{})}},x=()=>{Mt(t.appId,p=>{if(r.debug(p),p!=null&&p.code&&(p==null?void 0:p.message)!==void 0)switch(p.code){case"ok":m(p.message,{variant:"success"}),n(le({}));break;case"info":m(p.message,{variant:"info"});break;default:r.error(p),m(p.message??y.contactSupport,{variant:"error"})}else r.error(p),m(y.contactSupport,{variant:"error"});s(!1)},p=>{r.error("error",p),m(p??y.contactSupport,{variant:"error"}),s(!1)})},a=K("(max-width:700px)"),i=K("(max-width:900px)");return e.jsxs(e.Fragment,{children:[e.jsxs(l,{sx:{display:"grid",gridTemplateColumns:"auto auto",justifyContent:"space-between",alignItems:"center",padding:"24px",...i&&{".pp-row-actions":{width:0}},"&:hover":{".pp-row-title":{display:i?"inline-block":"none"},".pp-row-actions":{visibility:i?"hidden":"visible"}}},children:[e.jsxs(l,{sx:{display:"grid",gridTemplateColumns:"auto auto",alignItems:"center"},children:[e.jsxs(l,{sx:{width:"100%",display:"grid",gridTemplateColumns:"auto 1fr",gridGap:"10px",justifyContent:"center",alignItems:"center"},children:[e.jsx(l,{children:j()}),e.jsxs(l,{sx:{textOverflow:"ellipsis",whiteSpace:"nowrap",overflow:"hidden"},children:[t.appName,e.jsxs(l,{className:"pp-row-title",sx:{display:"inline-block",marginLeft:"5px",fontSize:"80%"},children:["−",e.jsx(l,{sx:{display:"inline-block",width:"5px"}}),t.appTitle]})]})]}),e.jsxs(l,{sx:{display:"grid",visibility:"hidden",gridTemplateColumns:"auto auto auto auto auto auto",gridGap:"10px",marginLeft:"10px",alignItems:"center"},className:"pp-row-actions",children:[e.jsx(l,{sx:{borderLeft:"1px solid black",height:"100%"}}),e.jsx(L,{title:"Manage App",children:e.jsx($,{sx:{cursor:"pointer"},underline:"none",onClick:p=>{u(t.appId),p.preventDefault(),p.stopPropagation()},children:"Manage"})}),e.jsx(l,{sx:{borderLeft:"1px solid black",height:"100%"}}),e.jsx(L,{title:"Run & Build App",children:e.jsx($,{sx:{cursor:"pointer"},underline:"none",onClick:p=>{n(ue({isActive:!0,appDbId:t.appId})),p.preventDefault(),p.stopPropagation()},children:"Run & Build"})}),e.jsx(l,{sx:{borderLeft:"1px solid black",height:"100%"}}),e.jsx(L,{title:"Delete App",children:e.jsx($,{sx:{cursor:"pointer"},underline:"none",onClick:p=>{s(!0),p.preventDefault(),p.stopPropagation()},children:"Delete"})})]})]}),e.jsxs(l,{sx:{display:"grid",gridTemplateColumns:"auto auto auto auto",justifyContent:a?"end":"space-evenly",alignItems:"center"},children:[e.jsx(l,{sx:{paddingRight:"10px"},children:a?"":Ge(t.appType)}),e.jsx(L,{title:"Manage App",children:e.jsx(G,{sx:{color:(A=Y)==null?void 0:A.palette.primary.main},onClick:p=>{u(t.appId),p.preventDefault(),p.stopPropagation()},children:e.jsx(nt,{})})}),e.jsx(L,{title:"Run & Build App",children:e.jsx(G,{sx:{color:(D=Y)==null?void 0:D.palette.primary.main},onClick:p=>{n(ue({isActive:!0,appDbId:t.appId})),p.preventDefault(),p.stopPropagation()},children:e.jsx(ot,{})})}),e.jsx(L,{title:"Delete App",children:e.jsx(G,{sx:{color:(R=Y)==null?void 0:R.palette.error.main},onClick:p=>{s(!0),p.preventDefault(),p.stopPropagation()},children:e.jsx(pt,{})})})]})]}),o&&e.jsx(V,{title:"Delete App?",message:"Are you sure you want to delete this app? This action cannot be undone!",open:o,setOpen:s,onConfirm:()=>x()})]})},Vt=({apps:t,search:n,types:o,isLoading:s})=>{r.debug(t,n,o);const u=x=>!(!Ye(x.appName+" "+x.appTitle,n)||o.length>0&&o.filter(a=>a.id===Number(x.appType)).length===0),j=t.filter(x=>u(x)?x:null);return e.jsx(Re,{elevation:4,children:e.jsxs(l,{sx:{backgroundColor:"#fff",borderBottom:"1px solid rgba(0, 0, 0, 0.34)",borderRadius:"4px","& .MuiBox-root:first-of-type":{borderTopLeftRadius:"4px",borderTopRightRadius:"4px"},"& .MuiBox-root:hover":{backgroundColor:"rgb(242, 242, 242)"}},children:[...t.map(x=>{const a=u(x);return e.jsx(l,{className:"pp-app-details",sx:{borderTop:"1px solid rgba(0, 0, 0, 0.34)",visibility:a?"visible":"hidden",position:a?"relative":"fixed"},children:e.jsx(Kt,{app:x})})}),j.length===0&&e.jsx(l,{sx:{padding:"35px",borderTop:"1px solid rgba(0, 0, 0, 0.34)",borderRadius:"4px"},children:s?e.jsx(lt,{title:"Loading apps...",align:He.LEFT}):e.jsx(l,{children:"No apps found"})})]})})},Qt=({setMode:t})=>{const n=O(),o=["App info","Data source","Authorization"],[s,u]=f.useState(0),[j,x]=f.useState(!1),a=k(h=>pe(h));r.debug("app",a),f.useEffect(()=>{let h=null;switch(a.appType){case T.DATATABLE:h=F.ANONYMOUS;break;case T.DATAENTRY:case T.MASTERDETAIL:case T.REGISTRATION:case T.UPDATEFORM:case T.APPCONTAINER:h=F.AUTHORIZED;break}h!==null?n(H({restApiActions:Je(h)})):m(y.contactSupport,{variant:"error"})},[a.appType]);const[i,A]=f.useState({appName:!1,appTitle:!1,appDatabase:!1,appTable:!1,appColumns:!1});r.debug(i);const D=()=>{const h=Ot(Ze);h.table.transactions.insert=Number(a.appType)===T.DATAENTRY||Number(a.appType)===T.MASTERDETAIL||Number(a.appType)===T.REGISTRATION,h.table.transactions.update=Number(a.appType)===T.DATAENTRY||Number(a.appType)===T.MASTERDETAIL||Number(a.appType)===T.UPDATEFORM,h.table.transactions.delete=Number(a.appType)===T.DATAENTRY||Number(a.appType)===T.MASTERDETAIL,kt(a,h,g=>{if(r.debug(g),g!=null&&g.code&&(g==null?void 0:g.message)!==void 0)switch(g.code){case"ok":m(g.message,{variant:"success"}),t(w.TABLE),n(le({}));break;case"info":m(g.message,{variant:"info"});break;default:r.error(g),m(g.message??y.contactSupport,{variant:"error"})}else r.error(g),m(y.contactSupport,{variant:"error"})},g=>{r.error("error",g),m(g??y.contactSupport,{variant:"error"})})},R=()=>{var g,M;let h=!0;if(s===0){let d=!1,v=!1;a.appName.trim()===""&&(m("App name is required",{variant:"error"}),d=!0,h=!1),a.appTitle.trim()===""&&(m("App title is required",{variant:"error"}),v=!0,h=!1),A({...i,appName:d,appTitle:v})}if(s===1){let d=!1,v=!1,_=!1;((g=a.appDatabase)==null?void 0:g.trim())===""&&(m("Database is required",{variant:"error"}),d=!0,h=!1),((M=a.appTable)==null?void 0:M.trim())===""&&(m("Table is required",{variant:"error"}),v=!0,h=!1),a.appColumns.length===0&&(m("No columns selected",{variant:"error"}),_=!0,h=!1),A({...i,appDatabase:d,appTable:v,appColumns:_})}return s===2&&D(),r.debug(h),h},p=()=>e.jsxs(l,{sx:{textAlign:"right",display:"grid",gridTemplateColumns:"auto auto",justifyContent:"space-between",alignItems:"center"},children:[s>0?e.jsx(P,{variant:"outlined",size:"medium",sx:{width:"160px",marginRight:"10px"},onClick:()=>{u(s-1)},startIcon:e.jsx(ct,{}),children:e.jsx(l,{children:"Back"})}):e.jsx(l,{}),e.jsx(P,{variant:"contained",size:"medium",sx:{width:"160px"},onClick:()=>{R()&&s<2&&u(s+1)},startIcon:s>=2&&e.jsx(dt,{}),endIcon:s<2&&e.jsx(ut,{}),children:e.jsx(l,{children:s<2?"Next":"Finish"})})]}),S=()=>e.jsxs(e.Fragment,{children:[e.jsx(Me,{app:a,hasErrors:i.appName}),e.jsx(ke,{app:a,hasErrors:i.appName}),e.jsx(Ne,{app:a}),p()]}),C=()=>e.jsxs(e.Fragment,{children:[e.jsx(Ce,{}),e.jsx(l,{sx:{display:a.appDatabase?"block":"none"},children:e.jsx(ve,{})}),e.jsx(l,{sx:{display:a.appTable?"block":"none"},children:e.jsx(Se,{app:a})}),p()]}),z=()=>e.jsxs(e.Fragment,{children:[e.jsx(l,{children:e.jsx(Ie,{})}),p()]});return e.jsxs(e.Fragment,{children:[e.jsxs(ie,{sx:{padding:"50px 70px 40px 70px",display:"grid",gridGap:"40px"},elevation:4,children:[e.jsxs(l,{sx:{display:"grid",gridTemplateColumns:"auto auto",justifyContent:"space-between",alignItems:"start"},children:[e.jsx(Lt,{title:"App Wizard",subheader:"Add new app",sx:{padding:0}}),e.jsx(l,{children:e.jsx(L,{title:"Close",children:e.jsx($,{sx:{cursor:"pointer"},underline:"none",onClick:h=>{x(!0),h.preventDefault(),h.stopPropagation()},children:e.jsx(l,{sx:{fontSize:"1.5rem",color:"#000"},children:e.jsx(Te,{})})})})})]}),e.jsxs(ae,{sx:{padding:0,display:"grid",gridGap:"30px"},children:[e.jsx(zt,{activeStep:s,sx:{margin:"10px 0 30px 0"},children:o.map((h,g)=>(r.debug(h,g),e.jsx(_t,{children:e.jsx(Bt,{children:h})},h)))}),e.jsxs("form",{onSubmit:h=>(h.preventDefault(),R()&&u(s+1),!1),style:{display:"grid",gridGap:"40px"},children:[s===0&&S(),s===1&&C(),s===2&&z(),e.jsx("input",{type:"submit",style:{display:"none"}})]})]})]}),e.jsx(V,{title:"Close App Wizard?",message:"All uncommitted changes will be lost!",open:j,setOpen:x,onConfirm:()=>{t(w.TABLE)}})]})};const Ds=()=>{const t=O(),n=f.useMemo(()=>xt(),[]),[o,s]=f.useState(w.TABLE);r.debug(o),f.useEffect(()=>{const c=localStorage.getItem("ppAppsDbsSearch");c!==null&&t(xe({dbSearch:c}));const b=localStorage.getItem("ppAppsDbsSearchType");if(b!==null){const E=JSON.parse(b);t(he({dbTypes:E}))}},[]);const u=k(c=>$e(c));r.debug("apps",u);const j=k(c=>Ke(c));r.debug("appDbId",j);const x=k(c=>Ve(c));r.debug("dbSearch",x);const a=k(c=>Qe(c));r.debug("dbTypes",a);const i=k(c=>Xe(c));r.debug("designMode",i);const A=k(c=>Ue(c));r.debug("reload",A);const[D,R]=f.useState(!0);f.useEffect(()=>{S(),p()},[A]);const p=()=>{Nt(function(c){const b=c==null?void 0:c.data;if(r.debug("response data",b),Array.isArray(b)){const E=[];for(let B=0;B<b.length;B++)E.push({appId:b[B].app_id,appName:b[B].app_name,appTitle:b[B].app_title,appType:b[B].app_type,appSettings:b[B].app_settings,appAddToMenu:b[B].app_add_to_menu});t(U({appList:E}))}else r.error(b),m((b==null?void 0:b.message)??y.contactSupport,{variant:"error"}),t(U({appList:[]}));R(!1)},c=>{r.error("error",c),m(c??y.contactSupport,{variant:"error"}),t(U({appList:[]})),R(!1)})},S=()=>{It(function(c){const b=c==null?void 0:c.data;r.debug("response data",b),t(st({appMetaData:b}))},c=>{r.error("error",c),m(c??y.contactSupport,{variant:"error"})})};f.useEffect(()=>{et.appPlugin&&(o===1||i.isActive===!0&&i.appDbId>0?window.document.documentElement.style.setProperty("--addAppIconVisibility","hidden"):window.document.documentElement.style.setProperty("--addAppIconVisibility","visible"),window.ppActionCreateApp=function(){o===0&&!(i.isActive===!0&&i.appDbId>0)&&s(w.FORM)})},[o,i]);const[C,z]=f.useState(250),h=K("(max-width: 600px)"),g=K("(max-width: 900px)");f.useEffect(()=>{v.current&&z(v.current.offsetWidth)},[a]);const M=rt(),d=be();r.debug(d);const v=f.useRef(),_=()=>i.isActive===!0&&i.appDbId>0,Ee=()=>e.jsx(L,{title:"Add new app",children:e.jsx(G,{sx:{color:"inherit"},onClick:()=>{t(fe({})),s(w.FORM)},children:e.jsx(gt,{})})}),ce={};return _()&&(ce.visibility="hidden"),e.jsxs(ht,{theme:M,children:[e.jsxs(l,{className:"pp-applist",sx:{width:"100%",visibility:_()?"hidden":"visible",position:_()?"fixed":"auto",height:_()?0:"auto",..._()&&{"& *":{visibility:"hidden"}},"& .pp-app-details":{...ce}},children:[e.jsx(je,{position:"relative",elevation:4,sx:{margin:"0 0 5px 0"},children:e.jsxs(Ae,{className:"pp-applist-toolbar",sx:{display:"grid",gap:"12px",paddingRight:"12px !important",...h?{gap:0,paddingRight:"10px",paddingBottom:"10px",paddingLeft:"10px","& .pp-applist-search":{gridTemplateColumns:"1fr",gridGap:"2px"}}:{...g?{gap:0,paddingRight:"10px",paddingBottom:"10px",paddingLeft:"10px","& .pp-applist-search":{justifyContent:"space-between",gridTemplateColumns:"auto 1fr"}}:{justifyContent:"space-between",gridTemplateColumns:"1fr 1fr"}}},children:[e.jsxs(l,{className:"pp-applist-title",sx:{display:"inline-grid",gridTemplateColumns:"auto auto",justifyContent:"start",alignItems:"center",gridGap:"10px"},children:[e.jsx(l,{sx:{fontSize:"18px",lineHeight:"18px",fontWeight:"bold",whiteSpace:"nowrap"},children:"Apps"}),e.jsx(l,{children:Ee()})]}),e.jsxs(l,{className:"pp-applist-search",sx:{display:"grid",gridTemplateColumns:"auto auto",gridGap:"10px",justifyContent:"end",alignItems:"center"},children:[e.jsx(q,{value:x,type:"search",placeholder:"Search",disabled:o===w.FORM,onChange:c=>{t(xe({dbSearch:c.target.value})),localStorage.setItem("ppAppsDbsSearch",c.target.value)},sx:{backgroundColor:"#fff",fontSize:"1em",margin:0,padding:0,borderRadius:"4px","&.MuiFormControl-root.MuiTextField-root .MuiInputBase-root":{paddingRight:0},"&.MuiFormControl-root.MuiTextField-root input":{padding:"8px"}},InputProps:{startAdornment:e.jsx(Pt,{position:"end",sx:{fontSize:"1.5rem",padding:0,margin:0},children:e.jsx(mt,{})})}}),e.jsx(oe,{multiple:!0,size:"small",options:d,getOptionLabel:c=>c.text,isOptionEqualToValue:(c,b)=>c.id===b.id,value:a,disableCloseOnSelect:!0,disabled:o===w.FORM,onChange:(c,b)=>{t(he({dbTypes:b.map(E=>({id:E.id,text:Object.values(tt)[E.id]}))})),localStorage.setItem("ppAppsDbsSearchType",JSON.stringify(b))},PaperComponent:({children:c})=>e.jsx(Re,{sx:{width:`${C}px`},children:c}),renderOption:(c,b,{selected:E})=>e.jsxs("li",{...c,children:[e.jsx(Gt,{style:{marginRight:8},checked:E}),b.text]}),renderInput:c=>e.jsx(l,{ref:v,children:e.jsx(q,{...c,sx:{minWidth:"250px","& .MuiInputBase-root":{backgroundColor:"#fff",padding:"0",maxHeight:"39px",overflow:"hidden"},"& .MuiButtonBase-root.MuiChip-root.MuiAutocomplete-tag":{height:"auto"}},placeholder:a.length===0?"Select app types":""})})})]})]})}),o===w.TABLE&&e.jsx(Vt,{apps:u,search:x,types:a,isLoading:D}),o===w.FORM&&e.jsx(Qt,{setMode:s}),j!==0&&j!==void 0&&e.jsx($t,{appDbId:j})]}),i.isActive===!0&&i.appDbId>0&&e.jsx(Ft,{appId:n,appDbId:i.appDbId,designMode:!0})]})};export{Ds as default};
