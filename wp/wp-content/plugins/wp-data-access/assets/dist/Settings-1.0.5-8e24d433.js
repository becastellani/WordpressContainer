import{b3 as Ee,l,r as C,a$ as we,ay as Z,cp as pe,cq as Ve,cr as Oe,cs as Ge,ct as Fe,j as e,cu as ie,bK as ue,cv as Ne,cw as Be,_ as We,cx as ze,bI as qe,v as z,cy as ne,cz as Je,cA as He,cB as Ke,cC as Ye,cD as De,cE as j,cF as $e,cG as Q,cH as se,c as Xe,cI as Ze,a as Qe,e as U,C as q,cJ as Ie,cK as re,bd as Me,P as es,cL as ss,k as fe,m as ts,cM as is,cN as ns,cO as rs}from"./main-1.0.5.js";import{b as Y,u as F,v as ls,a0 as _e,M as G,B as f,ag as as,a7 as be,ah as os,aa as ds,ab as cs,ac as ps,ad as us,D as Ue,T as Ce,e as ke,j as xs,k as gs,l as Re,ai as hs,aj as ms,A as js,d as fs}from"./main-1.0.5-a7d73e33.js";import{B as J,A as ye,C as Se,a as Te}from"./AdminTheme-1.0.5-04bcac94.js";import{u as bs,S as Cs,a as ys,I as ee,b as Ss,c as Ts,d as le,T as vs,M as ws,P as Fs,D as _s,e as Us,f as ks,g as Rs,h as Ps,i as As}from"./useMetadataColumns-1.0.5-808235db.js";import{a as X,C as me,S as Pe,R as Ls,B as Es,b as Vs,c as Os,d as Gs,e as ae,k as Ns}from"./settings-1.0.5-a609f2d7.js";import{h as Bs,f as Ws,g as zs}from"./index.esm-1.0.5-cbf5a94b.js";import{u as Ae}from"./useStoreTable-1.0.5-ca420c38.js";import{d as qs,e as Js,c as Hs}from"./index.esm-1.0.5-d97070f8.js";import{P as D}from"./PremiumFeature-1.0.5-90d69706.js";import{E as oe}from"./EnumTypeEnum-1.0.5-7ffcf33a.js";import{A as N,a as B,b as W}from"./AccordionSummary-1.0.5-0d0601e8.js";import{F as w,b as R,a as _,T as A,I as xe,S as ge}from"./TextField-1.0.5-7ecf712b.js";import{a as Ks,S as Ys}from"./ScopeEnum-1.0.5-02ab575a.js";import{R as he}from"./RadioGroup-1.0.5-2e2c1c10.js";import{R as O}from"./Radio-1.0.5-9d423ffa.js";import{L as ve}from"./Link-1.0.5-1e4979fb.js";import{I as H,T as Ds}from"./iconBase-1.0.5-f30be7a9.js";import{F as I}from"./FormControlLabel-1.0.5-d0651878.js";import{C as k}from"./CssUnitTextField-1.0.5-f5c56eef.js";import{C as $s,a as Xs,b as Zs}from"./ComponentDatabase-1.0.5-ceecb292.js";import{D as Qs,T as Is,a as de}from"./DefaultWhere-1.0.5-8f1d5f14.js";import{M}from"./MenuItem-1.0.5-151020c5.js";import{g as Ms,h as et,i as st}from"./ActionsApp-1.0.5-194aa982.js";import{S as tt,a as it,b as nt}from"./Stepper-1.0.5-49dc98b0.js";import"./index-1.0.5-198423ad.js";import rt from"./ThemeSettings-1.0.5-b3111983.js";import{T as ce}from"./Tabs-1.0.5-8b2f6dd8.js";import"./ActionsDml-1.0.5-5478d97e.js";import"./useTableUpdater-1.0.5-66078c4a.js";import"./Checkbox-1.0.5-abd3391a.js";import"./Close-1.0.5-697e5a3b.js";import"./DialogContent-1.0.5-383cf0b4.js";import"./useSlot-1.0.5-9b11ffd5.js";import"./ActionsExplorer-1.0.5-40895003.js";import"./index-1.0.5-565e836d.js";const te=s=>{const n=Y(i=>Ee(i,s));return l.debug("metaData",n),n},lt=s=>{const n=F();return C.useCallback((i,t)=>{Ms({app_id:i.app.app[0].app_id,cnt_id:i.app.container[0].cnt_id},r=>{const c=r==null?void 0:r.data;if(l.debug("response data",c),Array.isArray(c)){const d=we(Z.getState(),s)??[];for(let p=0;p<c.length;p++)if((c[p].cnt_relation===void 0||c[p].cnt_relation===null||c[p].cnt_relation===""?{}:JSON.parse(c[p].cnt_relation)).cnt_id_master===i.app.container[0].cnt_id){let a="";for(let o=0;o<d.length;o++)pe(Z.getState(),d[o].appId)!==void 0&&d[o].container.cnt_id===c[p].cnt_id&&(a=d[o].appId);if(a===""){const o={appId:ls(),container:c[p]};n(Ve({appId:s,detail:o}))}else{const o={appId:a,container:c[p]};n(Oe({appId:s,detail:o}))}}}else l.error("error loading details",r),t!==void 0&&t()},r=>{l.error("error loading details",r),t!==void 0&&t()})},[s])},at=s=>{const n=Y(i=>Ge(i,s));return l.debug("detailDisplayType",n),n},L=s=>{const n=F();return t=>{n(Fe({appId:s,isUpdated:t}))}},ot=({appId:s,columnIndex:n,tableColumn:i})=>{l.debug(s,n,i),F();const t=te(s),r=_e(s);L(s);const c=d=>[];return e.jsxs(N,{disableGutters:!0,children:[e.jsxs(B,{expandIcon:e.jsx(G,{}),sx:{fontSize:"1rem","& .MuiAccordionSummary-content":{padding:"1rem",alignItems:"center"}},children:[e.jsx(qs,{}),e.jsx("span",{style:{paddingLeft:"0.5rem"},children:"Grid positioning"})]}),e.jsxs(W,{sx:{paddingTop:"0.5rem"},children:[e.jsxs(f,{children:[e.jsxs(w,{sx:{display:"grid"},children:[e.jsx(R,{children:"Grid cells"}),e.jsx(Ks,{value:i.cells,min:1,max:r.cellsPerRow,step:1,marks:c(r.cellsPerRow),valueLabelDisplay:"auto",disabled:!0,onChange:(d,p)=>{l.debug(d,p)},sx:{width:"calc(100% - 40px)",margin:"20px"}})]}),e.jsx(_,{children:"Number of grid cells used (can be changed in FORM > Grid)"}),e.jsxs(w,{sx:{width:"100%"},children:[e.jsx(R,{sx:{margin:"15px 0 5px 0"},children:"Grid positioning"}),e.jsx(he,{sx:{flexDirection:"column",alignContent:"flex-start",marginLeft:"10px",marginBottom:"5px"},children:e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",justifyContent:"center",alignItems:"center"},children:[e.jsxs(R,{className:"align-label-radio",children:[e.jsx(O,{checked:i.cellClass===ie.AUTO,disabled:!0,onChange:d=>{d.stopPropagation()}}),"Auto"]}),e.jsxs(R,{className:"align-label-radio",children:[e.jsx(O,{checked:i.cellClass===ie.START,disabled:!0,onChange:d=>{d.stopPropagation()}}),"Start"]}),e.jsxs(R,{className:"align-label-radio",children:[e.jsx(O,{checked:i.cellClass===ie.END,disabled:!0,onChange:d=>{d.stopPropagation()}}),"End"]}),e.jsxs(R,{children:[e.jsx(O,{checked:typeof i.cellClass=="number",disabled:!0,onChange:d=>{d.stopPropagation()}}),"Add"]}),e.jsxs("div",{style:{marginLeft:"10px",gridColumn:"span 2",display:"grid",gridTemplateColumns:"auto auto",alignItems:"center"},children:[e.jsx(A,{id:"pp-cells-before",sx:{width:"60px"},className:"pp-cells-before",type:"number",defaultValue:1,InputProps:{inputProps:{min:1,max:r.cellsPerRow-1}},disabled:!0,InputLabelProps:{shrink:!0},onChange:d=>{d.stopPropagation()}}),e.jsx(R,{sx:{marginLeft:"10px"},children:"cell(s) before"})]})]})})]}),e.jsx(_,{children:"Grid positioning relative to surrounding cells"}),i.computedField&&n!==void 0&&(t==null?void 0:t.columns[n])!==void 0&&t.columns[n].data_type==="enum"&&e.jsxs(f,{sx:{marginTop:"20px"},children:[e.jsx(R,{children:"Show values in"}),e.jsxs(he,{sx:{flexDirection:"column",alignContent:"flex-start",margin:"10px 0 5px 10px"},children:[e.jsxs(R,{className:"align-label-radio",children:[e.jsx(O,{checked:i.updatableEnum===void 0||i.updatableEnum===oe.LIST,disabled:!0,onChange:d=>{d.stopPropagation()}}),"Drop-down List"]}),e.jsxs(R,{className:"align-label-radio",children:[e.jsx(O,{checked:i.updatableEnum===oe.RADIO_HORIZONTAL,disabled:!0,onChange:d=>{d.stopPropagation()}}),"Horizontal radio group"]}),e.jsxs(R,{className:"align-label-radio",children:[e.jsx(O,{checked:i.updatableEnum===oe.RADIO_VERTICAL,disabled:!0,onChange:d=>{d.stopPropagation()}}),"Vertical radio group"]})]})]})]}),e.jsx(D,{single:!1})]})]})},dt=({appId:s,columnIndex:n,tableColumn:i,columnMetaData:t})=>{l.debug(s,n,i),F(),L(s);const[r,c]=C.useState(!1);return i.computedField!==void 0||n===void 0||t===void 0||(t==null?void 0:t.data_type)!==void 0&&ue(t.data_type)!=="number"?null:e.jsxs(N,{disableGutters:!0,children:[e.jsxs(B,{expandIcon:e.jsx(G,{}),sx:{fontSize:"1rem","& .MuiAccordionSummary-content":{padding:"1rem",alignItems:"center"}},children:[e.jsx(Js,{}),e.jsx("span",{style:{paddingLeft:"0.5rem"},children:"Validation"})]}),e.jsxs(W,{sx:{paddingTop:"1rem"},children:[e.jsxs(w,{sx:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"10px"},children:[e.jsx(A,{error:r,type:"number",label:"Minimum value allowed",disabled:!0,value:i.numericMin??"",required:!1,InputLabelProps:{shrink:!0},onChange:d=>{l.debug(d)}}),e.jsx(A,{error:r,type:"number",label:"Maximum value allowed",disabled:!0,value:i.numericMax??"",required:!1,InputLabelProps:{shrink:!0},onChange:d=>{l.debug(d)}})]}),e.jsx(D,{})]})]})},ct=({appId:s,columnIndex:n,tableColumn:i,columnMetaData:t})=>{l.debug(s,n,i,t);const r=F(),c=L(s),[d,p]=C.useState(!1),T={marginTop:"20px",marginLeft:"10px",fontWeight:"bold"};return e.jsxs(N,{disableGutters:!0,children:[e.jsxs(B,{expandIcon:e.jsx(G,{}),sx:{fontSize:"1rem","& .MuiAccordionSummary-content":{padding:"1rem",alignItems:"center"}},children:[e.jsx(Hs,{}),e.jsx("span",{style:{paddingLeft:"0.5rem"},children:"Column settings"})]}),e.jsxs(W,{sx:{display:"grid",gridGap:"2rem",paddingTop:"1rem"},children:[e.jsxs(w,{children:[e.jsx(A,{type:"text",variant:"outlined",label:"Default value",value:i.defaultValue??"",placeholder:(t==null?void 0:t.column_default)??"",InputLabelProps:{shrink:!0},onChange:a=>{r(Ne({appId:s,index:n,defaultValue:a.target.value})),c(!0),a.stopPropagation()}}),e.jsxs(_,{component:"div",children:[e.jsx(e.Fragment,{children:(t==null?void 0:t.column_default)!==void 0&&(t==null?void 0:t.column_default)!==null&&(t==null?void 0:t.column_default)!==""&&e.jsx(f,{sx:{fontWeight:"bold"},children:"Leave empty to use column default constraint."})}),e.jsxs("div",{children:["Only applied on insert ",d?e.jsxs(e.Fragment,{children:[e.jsx("span",{children:e.jsx(ve,{sx:{cursor:"pointer"},underline:"none",onClick:()=>{p(!1)},children:"(hide examples)"})}),e.jsxs("ul",{children:[e.jsx("li",{children:"Hello World"}),e.jsx("li",{children:"@wpda_wp_user_id"}),e.jsx("li",{children:"@now"})]}),e.jsx("div",{style:T,children:"Notes"}),e.jsxs("ul",{children:[e.jsx("li",{children:"@wpda_wp_user_id returns the WordPress user ID or 0 for anonymous requests"}),e.jsx("li",{children:"@now returns the current date/time and works with date/time fields only"}),e.jsxs("li",{children:["Column default constraints defined in the database are automatically applied",(t==null?void 0:t.column_default)!==void 0&&(t==null?void 0:t.column_default)!==null&&(t==null?void 0:t.column_default)!==""&&e.jsxs(e.Fragment,{children:[" (current value is ",e.jsx("strong",{children:t==null?void 0:t.column_default}),")"]})]})]})]}):e.jsx("span",{children:e.jsx(ve,{sx:{cursor:"pointer"},underline:"none",onClick:()=>{p(!0)},children:"(show examples)"})})]})]})]}),((t==null?void 0:t.data_type)!==void 0&&t.data_type.toLowerCase()!=="text"&&t.data_type.toLowerCase()!=="enum"&&t.data_type.toLowerCase()!=="set"&&t.column_type.toLowerCase()!=="tinyint(1)"&&(ue(t.data_type)==="string"||ue(t.data_type)==="number")||i.computedField)&&e.jsxs(w,{children:[e.jsx(f,{sx:{display:"grid",gridTemplateColumns:"auto auto",gridGap:"10px",alignItems:"center"},children:e.jsxs(e.Fragment,{children:[e.jsx(A,{type:"text",variant:"outlined",label:"Prefix",value:i.prefix,disabled:!0,InputLabelProps:{shrink:!0},onChange:a=>{a.stopPropagation()}}),e.jsx(A,{type:"text",variant:"outlined",label:"Suffix",value:i.suffix,disabled:!0,InputLabelProps:{shrink:!0},onChange:a=>{a.stopPropagation()}})]})}),e.jsx(_,{children:"Adds a prefix and/or suffix to the column content"})]}),e.jsxs(w,{children:[e.jsx(A,{type:"text",variant:"outlined",label:"CSS classes",fullWidth:!0,value:i.classNames,disabled:!0,InputLabelProps:{shrink:!0},onChange:a=>{a.stopPropagation()}}),e.jsx(_,{children:"CSS classes (seperated by spaces) for custom styling"})]}),e.jsxs(w,{children:[e.jsx(A,{type:"text",variant:"outlined",label:"Hint",fullWidth:!0,value:i.hint,disabled:!0,InputLabelProps:{shrink:!0},onChange:a=>{a.stopPropagation()}}),e.jsx(_,{children:"Help text displayed below data entry field"})]}),e.jsx(D,{single:!1,margin:"0"})]})]})},pt=({appId:s,columnIndex:n,tableColumn:i})=>{var a,o;l.debug(s,n,i);const t=F(),r=Ae(s),c=te(s),p=bs(s)[i.columnName],T=(m,h)=>{t(Be({appId:s,index:m,lookup:h}))};return e.jsxs(e.Fragment,{children:[e.jsx(ot,{appId:s,columnIndex:n,tableColumn:i}),e.jsx(ct,{appId:s,columnIndex:n,tableColumn:i,columnMetaData:p}),(((a=c==null?void 0:c.privs)==null?void 0:a.insert)||((o=c==null?void 0:c.privs)==null?void 0:o.update))&&(r.table.transactions.insert||r.table.transactions.update)&&e.jsx(dt,{appId:s,columnIndex:n,tableColumn:i,columnMetaData:p}),e.jsx(Cs,{appId:s,columnIndex:n,tableColumn:i,columnMetaData:p,setLookup:T}),e.jsx(ys,{columnMetaData:p})]})};C.lazy(()=>We(()=>import("./ComputedFieldMore-1.0.5-779f599f.js"),["./ComputedFieldMore-1.0.5-779f599f.js","./main-1.0.5.js","./main-1.0.5-a7d73e33.js","./iconBase-1.0.5-f30be7a9.js","./main-1.0.5-ca6efa15.css","./settings-1.0.5-a609f2d7.js","./FormControlLabel-1.0.5-d0651878.js","./TextField-1.0.5-7ecf712b.js","./Close-1.0.5-697e5a3b.js","./DialogContent-1.0.5-383cf0b4.js","./AdminTheme-1.0.5-04bcac94.js","./Tabs-1.0.5-8b2f6dd8.js","./settings-1.0.5-5a196fc8.css","./index.esm-1.0.5-cbf5a94b.js","./MenuItem-1.0.5-151020c5.js"],import.meta.url));const ut=({appId:s,columnIndex:n})=>{l.debug(s,n);const i=F(),t=Ae(s),r=Y(u=>ze(u,s,n));l.debug("tableColumn",r);const c=L(s),d=(u,y)=>{l.debug(u,y),i(Je({appId:s,index:u,visible:y})),c(!0)},p=(u,y)=>{l.debug(u,y),i(He({appId:s,index:u,more:y})),c(!0)},T=(u,y)=>{l.debug(u,y),i(Ke({appId:s,index:u,updatable:y})),c(!0)};qe.TEXT;const[a,o]=C.useState(!1),[m,h]=C.useState(void 0),S=u=>{u!==void 0&&(i(Ye({appId:s,index:u})),c(!0))},P=(u,y,E)=>(l.debug(u,y,E),e.jsxs(e.Fragment,{children:[e.jsx(f,{children:e.jsx(Ss,{id:u,enabled:!1})}),e.jsxs(f,{sx:{display:"inline-grid",gridTemplateColumns:r.computedField!==void 0?"auto auto":"auto",justifyContent:"start",alignItems:"center",gap:"10px","& svg":{opacity:"0.5"}},children:[r.computedField!==void 0&&e.jsx(Bs,{}),e.jsx(R,{children:y})]})]}));return e.jsxs(e.Fragment,{children:[e.jsxs(N,{disableGutters:!0,slotProps:{transition:{unmountOnExit:!0}},children:[e.jsxs(B,{className:"pp-column-settings",expandIcon:e.jsx(G,{}),sx:{justifyContent:"space-between"},children:[e.jsx(f,{sx:{display:"grid",gridTemplateColumns:"auto 1fr",alignItems:"center","& svg":{display:"flex"}},children:P(r.columnName,r.columnLabel,n)}),e.jsxs(f,{style:{display:"grid",gridTemplateColumns:"40px 40px 40px"},children:[e.jsx(X,{title:"Visibility",position:"bottom",children:e.jsx(H,{onClick:u=>{r.visible?r.more?(d(n,!1),p(n,!1)):p(n,!0):r.more?p(n,!1):d(n,!0),u.stopPropagation()},children:r.visible?e.jsx(e.Fragment,{children:r.more?e.jsx(ee,{checked:!0,children:e.jsx(as,{})}):e.jsx(ee,{checked:!0,children:e.jsx(be,{})})}):e.jsx(ee,{checked:!1,children:e.jsx(be,{})})})}),r.computedField?e.jsx(e.Fragment,{children:e.jsx(X,{title:"Delete",position:"bottom",children:e.jsx(H,{onClick:u=>{o(!0),h(n),u.stopPropagation()},children:e.jsx(ds,{})})})}):e.jsx(X,{title:"Updatable",position:"bottom",disabled:!t.table.transactions.insert&&!t.table.transactions.update,children:e.jsx(H,{disabled:!t.table.transactions.insert&&!t.table.transactions.update,onClick:u=>{T(n,!r.updatable),u.stopPropagation()},children:e.jsx(ee,{checked:r.updatable&&(t.table.transactions.insert||t.table.transactions.update),disabled:!t.table.transactions.insert&&!t.table.transactions.update,children:e.jsx(os,{})})})}),e.jsx(X,{title:"Alignment",position:"bottom",children:e.jsxs(H,{onClick:u=>{r.alignment===z.LEFT?i(ne({appId:s,index:n,alignment:z.CENTER})):r.alignment===z.CENTER?i(ne({appId:s,index:n,alignment:z.RIGHT})):r.alignment===z.RIGHT&&i(ne({appId:s,index:n,alignment:z.LEFT})),c(!0),u.stopPropagation()},children:[r.alignment===z.LEFT&&e.jsx(cs,{}),r.alignment===z.CENTER&&e.jsx(ps,{}),r.alignment===z.RIGHT&&e.jsx(us,{})]})})]})]}),e.jsx(W,{children:e.jsx(pt,{appId:s,columnIndex:n,tableColumn:r})})]},n),e.jsx(me,{title:"Delete computed field?",message:"Are you sure you want to delete this computed field? This action cannot be undone!",open:a,setOpen:o,onConfirm:()=>S(m)})]})},xt=({appId:s})=>{l.debug(s),F();const n=Ts(le(Fs),le(ws),le(vs));L(s);const i=r=>{const{active:c,over:d}=r;(c==null?void 0:c.id)!==(d==null?void 0:d.id)&&l.debug(c,d)},t=Y(r=>De(r,s));return t===void 0||t.length===0?null:e.jsxs(e.Fragment,{children:[e.jsx(_s,{autoScroll:!0,sensors:n,collisionDetection:Us,onDragEnd:i,children:e.jsx(ks,{items:t,children:t.map((r,c)=>e.jsx(Rs,{id:r,children:e.jsx(ut,{appId:s,columnIndex:c})},r))})}),e.jsx(Ps,{appId:s,target:Ue.FORM})]})},gt=({appId:s,formSettings:n})=>(F(),L(s),e.jsxs(N,{defaultExpanded:!1,disableGutters:!0,children:[e.jsx(B,{expandIcon:e.jsx(G,{}),children:"Field layout"}),e.jsxs(W,{sx:{display:"grid"},children:[e.jsxs(w,{children:[e.jsxs(he,{value:n.fieldVariant,sx:{flexDirection:"row"},onChange:i=>{l.debug(i)},children:[e.jsx(I,{control:e.jsx(O,{disabled:!0}),value:"outlined",label:"Outlined"},"outlined"),e.jsx(I,{control:e.jsx(O,{disabled:!0}),value:"filled",label:"Filled"},"filled"),e.jsx(I,{control:e.jsx(O,{disabled:!0}),value:"standard",label:"Standard"},"standard")]}),e.jsx(_,{children:"Applies to data entry forms only"})]}),e.jsx(D,{})]})]})),ht=({appId:s,formSettings:n,updateSettings:i})=>(F(),L(s),e.jsxs(N,{defaultExpanded:!1,disableGutters:!0,children:[e.jsx(B,{expandIcon:e.jsx(G,{}),children:"Grid"}),e.jsxs(W,{sx:{display:"grid",gridTemplateColumns:"repeat(1, 1fr)",gap:"20px",marginTop:"5px"},children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"8px"},children:[e.jsx(A,{type:"number",label:"Cells per row",value:n.cellsPerRow,disabled:!0,InputLabelProps:{shrink:!0},onChange:t=>{l.debug(t)}}),e.jsx(k,{label:"Space between cells",textField:{cssValue:n.spacing.betweenCells,cssUnit:n.spacing.betweenCellsUnit},defaultValue:{cssValue:j.betweenCells,cssUnit:j.betweenCellsUnit},updateSettings:t=>{l.debug(t)}})]}),e.jsx(I,{control:e.jsx(Pe,{disabled:!0,checked:n.showGrid,onChange:(t,r)=>{l.debug(t,r)}}),label:"Show grid"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"8px",marginTop:"10px"},children:[e.jsx(k,{label:"Padding top",textField:{cssValue:n.spacing.aroundGridTop,cssUnit:n.spacing.aroundGridTopUnit},defaultValue:{cssValue:j.aroundGridTop,cssUnit:j.aroundGridTopUnit},updateSettings:t=>{l.debug(t)}}),e.jsx(k,{label:"Padding bottom",textField:{cssValue:n.spacing.aroundGridBottom,cssUnit:n.spacing.aroundGridBottomUnit},defaultValue:{cssValue:j.aroundGridBottom,cssUnit:j.aroundGridBottomUnit},updateSettings:t=>{l.debug(t)}}),e.jsx(k,{label:"Padding left",textField:{cssValue:n.spacing.aroundGridLeft,cssUnit:n.spacing.aroundGridLeftUnit},defaultValue:{cssValue:j.aroundGridLeft,cssUnit:j.aroundGridLeftUnit},updateSettings:t=>{l.debug(t)}}),e.jsx(k,{label:"Padding right",textField:{cssValue:n.spacing.aroundGridRight,cssUnit:n.spacing.aroundGridRightUnit},defaultValue:{cssValue:j.aroundGridRight,cssUnit:j.aroundGridRightUnit},updateSettings:t=>{l.debug(t)}})]}),e.jsx(D,{single:!1})]})]})),mt=({formSettings:s,updateSettings:n})=>e.jsxs(N,{defaultExpanded:!1,disableGutters:!0,children:[e.jsx(B,{expandIcon:e.jsx(G,{}),children:"Cells"}),e.jsxs(W,{style:{display:"grid",gridTemplateColumns:"repeat(1, 1fr)"},children:[e.jsxs(w,{children:[e.jsxs(f,{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"8px",marginTop:"5px"},children:[e.jsx(k,{label:"Padding top",textField:{cssValue:s.spacing.cellTop,cssUnit:s.spacing.cellTopUnit},defaultValue:{cssValue:j.cellTop,cssUnit:j.cellTopUnit},updateSettings:i=>{l.debug(i)}}),e.jsx(k,{label:"Padding bottom",textField:{cssValue:s.spacing.cellBottom,cssUnit:s.spacing.cellBottomUnit},defaultValue:{cssValue:j.cellBottom,cssUnit:j.cellBottomUnit},updateSettings:i=>{l.debug(i)}}),e.jsx(k,{label:"Padding left",textField:{cssValue:s.spacing.cellLeft,cssUnit:s.spacing.cellLeftUnit},defaultValue:{cssValue:j.cellLeft,cssUnit:j.cellLeftUnit},updateSettings:i=>{l.debug(i)}}),e.jsx(k,{label:"Padding right",textField:{cssValue:s.spacing.cellRight,cssUnit:s.spacing.cellRightUnit},defaultValue:{cssValue:j.cellRight,cssUnit:j.cellRightUnit},updateSettings:i=>{l.debug(i)}})]}),e.jsx(_,{sx:{marginTop:"20px"},children:"Spacing around cells"})]}),e.jsx(D,{single:!1})]})]}),jt=({formSettings:s,updateSettings:n})=>e.jsxs(N,{defaultExpanded:!1,disableGutters:!0,children:[e.jsx(B,{expandIcon:e.jsx(G,{}),children:"Field spacing"}),e.jsxs(W,{sx:{display:"grid"},children:[e.jsxs(w,{children:[e.jsxs(f,{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"8px",marginTop:"5px"},children:[e.jsx(k,{label:"Padding top",textField:{cssValue:s.spacing.fieldTop,cssUnit:s.spacing.fieldTopUnit},defaultValue:{cssValue:j.fieldTop,cssUnit:j.fieldTopUnit},updateSettings:i=>{l.debug(i)}}),e.jsx(k,{label:"Padding bottom",textField:{cssValue:s.spacing.fieldBottom,cssUnit:s.spacing.fieldBottomUnit},defaultValue:{cssValue:j.fieldBottom,cssUnit:j.fieldBottomUnit},updateSettings:i=>{l.debug(i)}}),e.jsx(k,{label:"Padding left",textField:{cssValue:s.spacing.fieldLeft,cssUnit:s.spacing.fieldLeftUnit},defaultValue:{cssValue:j.fieldLeft,cssUnit:j.fieldLeftUnit},updateSettings:i=>{l.debug(i)}}),e.jsx(k,{label:"Padding right",textField:{cssValue:s.spacing.fieldRight,cssUnit:s.spacing.fieldRightUnit},defaultValue:{cssValue:j.fieldRight,cssUnit:j.fieldRightUnit},updateSettings:i=>{l.debug(i)}})]}),e.jsx(_,{sx:{marginTop:"20px"},children:"Spacing within data entry fields"})]}),e.jsx(D,{single:!1})]})]}),ft=({appId:s,formSettings:n})=>{var c;const i=F(),t=L(s),r=te(s);return!((c=r==null?void 0:r.privs)!=null&&c.update)||r.primary_key.length===0?null:e.jsxs(N,{defaultExpanded:!1,disableGutters:!0,children:[e.jsx(B,{expandIcon:e.jsx(G,{}),children:"Null value handling"}),e.jsxs(W,{sx:{display:"grid"},children:[e.jsx(I,{control:e.jsx(Pe,{checked:n.preserveSpacesOnUpdate,onChange:(d,p)=>{i($e({appId:s,preserveSpaces:p})),t(!0),d.stopPropagation()}}),label:"Preserve empty strings on update",labelPlacement:"end"}),e.jsx(_,{children:"Enable to preserve empty strings for mandatory columns. Works only if the actual column value contains an empty spaces. Does not allow strings to be emptied."}),e.jsx(_,{children:"This feature is enabled by default on WordPress tables."}),e.jsx(_,{sx:{fontWeight:"bold"},children:"Do NOT change the default unless you really need to!"})]})]})},bt=({appId:s,app:n,relationship:i,metaData:t})=>{l.debug(s,n,i,t);const r=F(),c=L(s),[d,p]=C.useState(i.joins.split(",").map(o=>{const m=o.split("=");return{masterColumn:m[0],detailColumn:m[1]??""}}));l.debug("joins",d),C.useEffect(()=>{const o={...i};o.joins=d.map(m=>m.masterColumn+"="+m.detailColumn).join(","),r(Q({appId:s,relationship:o})),c(!0)},[d]);const T=t.app.container[0].cnt_tbl,a=t.app.container[0].cnt_cls===void 0||t.app.container[0].cnt_cls===null||t.app.container[0].cnt_cls===""?{}:JSON.parse(t.app.container[0].cnt_cls);return e.jsxs(f,{children:[...d.map((o,m)=>e.jsx(f,{sx:{display:"grid",marginTop:"10px"},children:e.jsxs(f,{sx:{display:"grid",gridTemplateColumns:"minmax(0, 1fr) 20px minmax(0, 1fr) auto",alignItems:"center"},children:[e.jsxs(w,{children:[e.jsx(xe,{variant:"outlined",children:"master"}),e.jsxs(ge,{label:"master",value:o.masterColumn,onChange:h=>{const S=[...d];S[m].masterColumn=h.target.value,p(S),c(!0)},children:[...a.map(h=>h.isSelected?e.jsxs(M,{value:h.columnName,children:[T,".",h.columnName]}):null)]})]}),e.jsx(f,{sx:{textAlign:"center"},children:"="}),e.jsxs(w,{children:[e.jsx(xe,{variant:"outlined",children:"detail"}),e.jsxs(ge,{label:"detail",value:o.detailColumn,onChange:h=>{const S=[...d];S[m].detailColumn=h.target.value,p(S),c(!0)},children:[...n.appColumns.map(h=>h.isSelected?e.jsxs(M,{value:h.columnName,children:[n.appTable,".",h.columnName]}):null)]})]}),e.jsx(f,{children:m===0?e.jsx(Ce,{title:"Add condition",children:e.jsx(H,{color:"primary",onClick:()=>{const h=[...d];h.push({masterColumn:"",detailColumn:""}),p(h),c(!0)},children:e.jsx(Ws,{})})}):e.jsx(Ce,{title:"Add condition",children:e.jsx(H,{color:"primary",onClick:()=>{const h=[...d];h.splice(m,1),p(h),c(!0)},children:e.jsx(zs,{})})})})]})})),e.jsx(f,{sx:{marginTop:"20px"},children:e.jsxs(w,{fullWidth:!0,children:[e.jsx(A,{fullWidth:!0,label:"Optional conditions",multiline:!0,minRows:1,maxRows:10,value:i.sql,placeholder:"Use this field to add additional conditions to show specific details only or leave blank",onChange:o=>{const m={...i};m.sql=o.target.value,r(Q({appId:s,relationship:m})),c(!0)}}),e.jsx(Qs,{})]})}),i.cardinality===se.ONE_TO_ONE&&e.jsx(f,{sx:{marginTop:"20px"},children:e.jsx(w,{fullWidth:!0,children:e.jsx(_,{children:"A join for a 1:1 relationship must return exactly one record. An error is shown when a detail query returns more than 1 record."})})})]})},Ct=({appId:s,metaData:n,isUpdating:i,initialRelationships:t,initialTitle:r,enableWizard:c})=>{const d=F(),p=lt(s),T=L(s),a=Y(g=>Xe(g));l.debug("app",a);const o=Y(g=>Ze(g));l.debug("relationship",o),C.useEffect(()=>{const g={...o};g.title=a.appTitle??"",g.dbs=a.appDatabase??"",g.tbl=a.appTable??"",g.cls=a.appColumns,d(Q({appId:s,relationship:g}))},[a.appDatabase,a.appTable,a.appColumns,a.appTitle]);const[m,h]=C.useState(""),S=["Relationship info","Select data source","Define join condition"],[P,u]=C.useState(0),y=g=>{switch(l.debug(g),g){case 0:if(a.appTitle===""||a.appTitle===null||r!==a.appTitle&&t.filter(x=>x.title===a.appTitle).length>0)return h("title"),!1;h("");break;case 1:if(a.appDatabase===""||a.appDatabase===null||a.appTable===""||a.appTable===null)return!1;break}return!0},E=g=>(l.debug(g),e.jsxs(f,{sx:{display:"grid",gridTemplateColumns:"1fr 1fr",justifyContent:"space-between",alignItems:"center",gap:"5px"},children:[g===0?e.jsx(f,{}):e.jsx(J,{variant:"contained",startIcon:e.jsx(xs,{}),onClick:()=>{u(g-1)},children:"Previous"}),g===2?e.jsx(J,{variant:"contained",startIcon:e.jsx(gs,{}),onClick:()=>{u(g+1)},children:"Finish"}):e.jsx(J,{variant:"contained",endIcon:e.jsx(Re,{}),onClick:()=>{y(g)&&u(g+1)},children:"Next"})]}));return e.jsxs(e.Fragment,{children:[P<=S.length&&e.jsx(f,{sx:{textAlign:"right"},children:e.jsx(J,{variant:"outlined",startIcon:e.jsx(ke,{}),onClick:()=>{c(!1),T(!1)},children:"Cancel"})}),e.jsx(tt,{activeStep:P,orientation:"vertical",sx:{marginBottom:0},children:S.map((g,x)=>e.jsxs(it,{children:[e.jsx(nt,{children:g}),e.jsx(As,{children:e.jsxs(f,{sx:{display:"grid",gap:"20px",marginTop:"20px"},children:[x===0&&e.jsxs(e.Fragment,{children:[e.jsxs(w,{children:[e.jsxs(Is,{fullWidth:!0,color:"primary",exclusive:!0,value:o.cardinality,onChange:(K,V)=>{const $={...o};$.cardinality=V,d(Q({appId:s,relationship:$})),T(!0)},children:[e.jsx(de,{value:se.ONE_TO_ONE,children:"1:1"}),e.jsx(de,{value:se.ONE_TO_MANY,children:"1:m"}),e.jsx(de,{value:se.MANY_TO_MANY,disabled:!0,children:"m:m"})]}),e.jsx(_,{children:"Cardinality (m:m coming soon...)"})]}),e.jsx(A,{type:"text",label:"Title",error:m==="title",value:a.appTitle,fullWidth:!0,required:!0,helperText:"Container title (must be unique witin this form)",autoComplete:"off",onChange:K=>{d(Qe({appTitle:K.target.value}));const V={...o};V.title=K.target.value,d(Q({appId:s,relationship:V})),T(!0)}}),E(x)]}),x===1&&e.jsxs(e.Fragment,{children:[e.jsx($s,{}),e.jsx(Xs,{}),e.jsx(Zs,{app:a}),E(x)]}),x===2&&e.jsxs(e.Fragment,{children:[e.jsx(bt,{appId:s,app:a,metaData:n,relationship:o}),E(x)]})]})})]},g))}),P===S.length&&e.jsxs(f,{sx:{marginTop:"20px",display:"grid",gap:"20px"},children:[e.jsx(f,{children:"Relationship wizard successfully completed. Click button below to activate."}),e.jsx(J,{fullWidth:!0,variant:"contained",onClick:()=>{const g={app_id:n.app.container[0].app_id,app_title:o.title,app_dbs:o.dbs,app_tbl:o.tbl,app_cls:o.cls,app_relation:JSON.stringify({cnt_id_master:n.app.container[0].cnt_id,cardinality:o.cardinality,join_condition:o.joins,sql:o.sql})};i?(g.app_cnt=a.appCntId,st(g,x=>{l.debug(x),(x==null?void 0:x.code)==="ok"&&(x==null?void 0:x.message)===""?(c(!1),U("Relationship updated",{variant:"success"}),p(n,()=>{U(q.contactSupport,{variant:"error"})}),T(!1)):U(q.contactSupport,{variant:"error"})},x=>{l.error(x),U(q.contactSupport,{variant:"error"})},!1)):et(g,x=>{l.debug(x),(x==null?void 0:x.code)==="ok"&&(x==null?void 0:x.message)===""?(c(!1),U("Relationship created",{variant:"success"}),p(n,()=>{U(q.contactSupport,{variant:"error"})}),T(!1)):U(q.contactSupport,{variant:"error"})},x=>{l.error(x),U(q.contactSupport,{variant:"error"})},!1)},children:i?"Update relationship":"Create relationship"})]})]})},yt=({appId:s})=>{var u;l.debug(s);const n=F();hs();const i=at(s),[t,r]=C.useState(!1);l.debug("wizardOn",t);const[c,d]=C.useState(!1);l.debug("wizardIsUpdating",c);const[p,T]=C.useState("");l.debug("wizardTitle",p);const a=te(s);l.debug(a);const o=Y(y=>we(y,s));l.debug("details",o);const[m,h]=C.useState([]);l.debug(m),C.useEffect(()=>{var E,g,x,K,V;const y=[];if(o!==void 0&&o.length>0&&((E=a==null?void 0:a.app)==null?void 0:E.container)!==void 0&&Array.isArray((g=a==null?void 0:a.app)==null?void 0:g.container)){const $=a.app.container[0].cnt_id,b=a.app.container[0].cnt_tbl;for(let v=0;v<o.length;v++)if(((x=o[v].container)==null?void 0:x.cnt_relation)!==void 0&&((K=o[v].container)==null?void 0:K.cnt_relation)!==null&&((V=o[v].container)==null?void 0:V.cnt_relation)!==""){const je=JSON.parse(o[v].container.cnt_relation);if(je.cnt_id_master===$){const Le=o[v].appId;y.push({appId:Le,cntId:o[v].container.cnt_id,title:o[v].container.cnt_title,dbs:o[v].container.cnt_dbs,tbl:o[v].container.cnt_tbl,cls:o[v].container.cnt_cls===void 0||o[v].container.cnt_cls===null||o[v].container.cnt_cls===""?{}:JSON.parse(o[v].container.cnt_cls),relation:je,parentTbl:b})}}}h(y)},[s,(u=a==null?void 0:a.app)==null?void 0:u.container,o]),C.useState(""),C.useState(-1);const[S,P]=C.useState(!1);return C.useState(""),e.jsxs(e.Fragment,{children:[e.jsxs(N,{defaultExpanded:!1,disableGutters:!0,children:[e.jsx(B,{expandIcon:e.jsx(G,{}),children:"Relationships"}),e.jsxs(W,{children:[!1,e.jsx(f,{children:t?e.jsx(e.Fragment,{children:!c&&e.jsx(Ct,{appId:s,metaData:a,isUpdating:c,enableWizard:r,initialRelationships:m,initialTitle:""})}):e.jsx(J,{variant:"contained",fullWidth:!0,disabled:!0,startIcon:e.jsx(ms,{}),endIcon:e.jsx(Re,{}),onClick:()=>{},children:"Start relationship wizard"})}),e.jsx(e.Fragment,{children:m.length>0&&e.jsx(f,{sx:{marginTop:"30px"},children:e.jsxs(w,{fullWidth:!0,children:[e.jsx(xe,{variant:"outlined",children:"Display type"}),e.jsxs(ge,{value:i,label:"Display type",onChange:y=>{n(Ie({appId:s,displayType:y.target.value}))},children:[e.jsx(M,{value:re.ACOORDION,children:"Accordion"}),e.jsx(M,{value:re.TAB,children:"Tabs"}),e.jsx(M,{value:re.TITLE,children:"Titles"})]}),e.jsx(_,{children:"Select how details should be displayed"})]})})}),e.jsx(D,{})]})]}),S&&e.jsx(me,{title:"Delete Relationship?",message:"Are you sure you want to delete this relationship? This action cannot be undone!",open:S,setOpen:P,onConfirm:()=>{}})]})},St=({appId:s})=>{l.debug(s),F(),L(s);const n=_e(s),i=t=>{l.debug(t)};return e.jsxs(e.Fragment,{children:[e.jsx(yt,{appId:s}),e.jsx(gt,{appId:s,formSettings:n}),e.jsx(ht,{appId:s,formSettings:n,updateSettings:i}),e.jsx(mt,{formSettings:n,updateSettings:i}),e.jsx(jt,{formSettings:n,updateSettings:i}),e.jsx(ft,{appId:s,formSettings:n})]})},ni=({appId:s})=>{var V,$;l.debug(s);const n=F(),[i,t]=C.useState(pe(Z.getState(),s));l.debug(i);const[r,c]=C.useState(Me(Z.getState(),s));l.debug(r);const d=()=>rs(Z.getState(),s),p=b=>{n(Fe({appId:s,isUpdated:b}))},[T,a]=C.useState(!1),o=((V=ye)==null?void 0:V.palette.mode)===es.LIGHT?($=ye)==null?void 0:$.palette.primary.main:"",m=b=>{n(ts({anchor:b}))},h=()=>{n(is({appId:s,formState:i}))},S=()=>{n(ns({})),p(!1)},P=()=>{d()?a(!0):(h(),S())},u=()=>{Ns(s,Ys.GLOBAL,b=>{if(l.debug(b),b!=null&&b.code&&(b==null?void 0:b.message)!==void 0)switch(b.code){case"ok":t(pe(Z.getState(),s)),U(b.message,{variant:"success"});break;case"info":U(b.message,{variant:"info"});break;default:l.error(b),U(b.message??q.contactSupport,{variant:"error"})}else l.error(b),U(q.contactSupport,{variant:"error"})},b=>{l.error("error",b),U(b??q.contactSupport,{variant:"error"})}),p(!1)},y=()=>{d()?(u(),setTimeout(()=>{S()},1e3)):S()},[E,g]=C.useState("1"),x=(b,v)=>{g(v)},K=Y(b=>ss(b,s));return e.jsx(e.Fragment,{children:K&&e.jsxs(e.Fragment,{children:[e.jsxs(Ls,{closeDrawer:P,children:[e.jsx(js,{position:"static",elevation:4,sx:{borderRadius:0},children:e.jsxs(fs,{className:"pp-setting-toolbar",sx:{borderRadius:0},children:[e.jsx(Ds,{variant:"h5",noWrap:!0,component:"div",className:"unselectable",sx:{flexGrow:1,display:{xs:"none",sm:"block"},paddingLeft:"6px"},children:"Form Builder"}),e.jsx(X,{title:"Dock to left",position:"bottom",children:e.jsx(H,{onClick:()=>{m(fe.LEFT)},size:"large",color:"inherit",sx:{fontSize:"1em"},children:e.jsx(Es,{})})}),e.jsx(X,{title:"Dock to right",position:"bottom",children:e.jsx(H,{onClick:()=>{m(fe.RIGHT)},size:"large",color:"inherit",sx:{fontSize:"1em"},children:e.jsx(Vs,{})})}),e.jsx(X,{title:"Close",position:"bottom",children:e.jsx(H,{onClick:P,size:"large",color:"inherit",sx:{fontSize:"1.4em"},children:e.jsx(ke,{})})})]})}),e.jsx(Se,{className:"pp-settings-container",children:e.jsx(Te,{sx:{padding:0,margin:0},children:e.jsxs(Os,{value:E,children:[e.jsxs(Gs,{variant:"fullWidth",textColor:"primary",onChange:x,sx:{width:"100%",height:"80px",padding:0,margin:0,backgroundColor:"rgb(242, 242, 242)"},children:[e.jsx(ce,{label:"Form",value:"1",sx:{fontWeight:"bold",fontSize:"110%",height:"80px"}}),e.jsx(ce,{label:"Columns",value:"2",sx:{fontWeight:"bold",fontSize:"110%",height:"80px"}}),e.jsx(ce,{label:"Theme",value:"3",sx:{fontWeight:"bold",fontSize:"110%",height:"80px"}})]}),e.jsxs(f,{sx:{margin:0,padding:0,overflowY:"auto",height:"calc(100vh - 250px)","& > div.MuiTabPanel-root":{padding:0}},children:[e.jsx(ae,{value:"1",children:e.jsx(St,{appId:s})}),e.jsx(ae,{value:"2",children:e.jsx(xt,{appId:s})}),e.jsx(ae,{value:"3",children:e.jsx(rt,{appId:s,source:Ue.FORM,setIsUpdated:p})})]})]})})}),e.jsx(Se,{className:"pp-setting-footer",sx:{borderRadius:0,backgroundColor:o},children:e.jsxs(Te,{className:"pp-setting-footer-buttons",sx:{borderRadius:0},children:[e.jsx(J,{variant:"outlined",className:"footer_action_button_apply",onClick:u,children:"Apply"}),e.jsx(J,{variant:"outlined",className:"footer_action_button",onClick:y,children:"OK"}),e.jsx(J,{variant:"outlined",className:"footer_action_button",onClick:P,children:"Cancel"})]})})]}),e.jsx(me,{title:"Close Form Builder?",message:"All uncommitted changes will be lost!",open:T,setOpen:a,onConfirm:()=>{h(),S()},onKeep:()=>{S()}})]})})};export{ni as default};
